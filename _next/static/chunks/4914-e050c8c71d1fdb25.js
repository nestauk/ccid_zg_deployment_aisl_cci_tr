"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4914],{30089:function(e,t,n){n.d(t,{Cc:function(){return h},H7:function(){return b},av:function(){return f},f_:function(){return m},if:function(){return u},kh:function(){return p},ot:function(){return g},pC:function(){return v},tL:function(){return x},te:function(){return d},yg:function(){return y}});var i=n(6121),o=n(20920),r=n(15785),s=n(71359),a=n(45080),l=n(2962),c=n(24132);let d=(e,t)=>{if(void 0!==e){let i=(0,o.Z)();if(void 0!==e.key&&null!==e.key){var n;return{...e,key:"".concat(t,"-").concat(null!==(n=e.key)&&void 0!==n?n:"undefined","+").concat(i)}}}},u=e=>e?Object.fromEntries(e.split(";").map(e=>e.trim().split(":").map(e=>e.trim()))):{},h=e=>e?Object.fromEntries(e.split(";").map(e=>e.trim().split(":").map(e=>e.trim()))):{},p=e=>{if(null!=e&&0!==e.length)return(0,i.Q)(e,{columns:!1,skip_empty_lines:!0,trim:!0})[0]},x=e=>null==e?void 0:e.map((e,t)=>""===e?" ".repeat(t):e),m=e=>{let t=parseFloat(null!=e?e:"");return isNaN(t)?void 0:t},f=e=>{let t=null==e?void 0:e.toLowerCase(),n=s.Q[t];if(void 0===n)throw console.error("Unknown slider input type: ".concat(e)),"Unknown slider input type: ".concat(e);return n},g=e=>{let t=null==e?void 0:e.toLowerCase(),n=c.rT[t];if(void 0===n)throw console.error("Unknown graph input type: ".concat(e)),"Unknown graph input type: ".concat(e);return n},y=e=>{let t=null==e?void 0:e.toLowerCase(),n=l.J[t];if(void 0===n)throw console.error("Unknown graph orientation: ".concat(e)),"Unknown graph orientation: ".concat(e);return n},b=e=>{let t=null==e?void 0:e.toLowerCase(),n=a.L[t];if(void 0===n)throw console.error("Unknown text input type: ".concat(e)),"Unknown text input type: ".concat(e);return n},v=e=>{let t=null==e?void 0:e.toLowerCase(),n=r.S[t];if(void 0===n)throw console.error("Unknown slide activity: ".concat(e)),"Unknown slide activity: ".concat(e);return n}},8260:function(e,t,n){n.d(t,{S9:function(){return c},UJ:function(){return l},ZP:function(){return d},Zp:function(){return a}});var i=n(2265),o=n(11144);let r=(e,t)=>{let{sid:n,pid:i,qid:o}=e;return{id:void 0,created:void 0,questionId:o,participantId:i,jsonValue:void 0,mimeType:void 0,pII:t}},s=e=>{let t={};return e.forEach(e=>{var n;t[e.questionId]=[...null!==(n=t[e.questionId])&&void 0!==n?n:[],e]}),t},a=(e,t,n)=>{var i;return null!==(i=l(e,t))&&void 0!==i?i:r(t,null!=n&&n)},l=(e,t)=>null==e?void 0:e.find(e=>e.questionId===t.qid&&e.participantId===t.pid),c=e=>(null==e?void 0:e.jsonValue)!==void 0;function d(e){var t;let{session:n}=(0,i.useContext)(o.z),[r,a]=(0,i.useState)(null!==(t=n.answers)&&void 0!==t?t:[]),[l,c]=(0,i.useState)(s(n.answers));return(0,i.useEffect)(()=>{var t;a(void 0!==e?n.answers.filter(t=>t.questionId===e):[]),c(null!==(t=s(n.answers))&&void 0!==t?t:{})},[n.answers]),{answers:r,allAnswers:l}}},67506:function(e,t,n){n.d(t,{G:function(){return d},Z:function(){return u}});var i,o,r=n(57437),s=n(80237),a=n(2265),l=n(83593),c=n(23447);let d=(0,a.createContext)({});function u(e){var t;let{api:n,start:i}=(0,a.useContext)(c.E),[o,u]=(0,a.useState)(0),[h,p]=(0,a.useState)(),[x,m]=(0,a.useState)(null!==(t=e.checks)&&void 0!==t?t:3);(0,a.useEffect)(()=>{switch(o){case 0:l.Z.emit({type:l.M.Content_Progress_Update,data:{overall:{completed:0,total:x},bars:{}}}),u(1);break;case 1:f().then(e=>{p(e),u(3)}).catch(e=>{console.error(e),u(2)})}},[o]);let f=async()=>{switch(e.mode){case"server-date-lib":return y();case"zg-server-time":return g();default:throw Error("Unsupported time sync mode")}},g=async()=>{let e;await i(n.getServerTime());let t=Number.MAX_SAFE_INTEGER,o=0;for(let r=0;r<x;r++){let s=Date.now(),a=await i(n.getServerTime()),c=Date.now(),d=c-s,u=(s+c)/2,h=a.timestamp-u;d<t&&(t=d,o=h,e=a),l.Z.emit({type:l.M.Content_Progress_Update,data:{overall:{completed:r+1,total:x},bars:{}}}),await new Promise(e=>setTimeout(e,1e3))}return{offset:o,rtt:t,source:e,toServerTime:e=>Math.round(e+o),fromServerTime:e=>Math.round(e-o)}},y=async()=>{let e;console.warn("ServerDateLib is only accurate to the second.");for(let t=0;t<x;t++){await new Promise(e=>setTimeout(e,1e3));let n=await (0,s.a)();(void 0===e||Math.abs(n.uncertainty)<Math.abs(e.uncertainty))&&(e=n),l.Z.emit({type:l.M.Content_Progress_Update,data:{overall:{completed:t+1,total:x},bars:{}}})}return{offset:e.offset,source:e,rtt:e.uncertainty,toServerTime:t=>t+e.offset,fromServerTime:t=>t-e.offset}};return(0,r.jsxs)(r.Fragment,{children:[(0===o||1===o)&&e.load,2===o&&e.error,3===o&&(0,r.jsx)(d.Provider,{value:h,children:e.children})]})}(i=o||(o={}))[i.Init=0]="Init",i[i.Synchronising=1]="Synchronising",i[i.Error=2]="Error",i[i.Complete=3]="Complete"},53622:function(e,t,n){n.d(t,{Z:function(){return s},p:function(){return r}});var i=n(57437),o=n(2265);let r=(0,o.createContext)({});function s(e){let[t,n]=(0,o.useState)({language:e.searchParams.get("lang")});return(0,i.jsx)(r.Provider,{value:t,children:e.children})}},4766:function(e,t,n){n.d(t,{X:function(){return d},Z:function(){return u}});var i=n(57437),o=n(2265),r=n(94547),s=n(15785),a=n(11144),l=n(5085),c=n(23447);let d=(0,o.createContext)({});function u(e){let{role:t}=(0,o.useContext)(l.rZ),{session:n}=(0,o.useContext)(a.z),{user:u,sessionToken:h,deviceId:p}=(0,o.useContext)(l.rZ),[x,m]=(0,o.useState)(s.I),[f,g]=(0,o.useState)(),y=(0,o.useRef)(0),{start:b,api:v}=(0,o.useContext)(c.E);(0,o.useEffect)(()=>{t===r._b.Controller&&j()},[]),(0,o.useEffect)(()=>{console.debug("LiveExperienceState change...",n.liveExperienceState),n.liveExperienceState.sequence>=y.current&&n.liveExperienceState.originator!==p&&(g(n.liveExperienceState.slideX),y.current=n.liveExperienceState.sequence)},[n.liveExperienceState]),(0,o.useEffect)(()=>{console.debug("SlideIndex change...",f),void 0!==f&&(t===r._b.Controller&&k(f),t===r._b.Controller&&w(f))},[f]);let j=()=>{let e=window.localStorage.getItem("RevealState-".concat(n.id));e&&g(JSON.parse(e).index)},w=e=>{if(t===r._b.Controller){let t=JSON.stringify({index:e});window.localStorage.setItem("RevealState-".concat(n.id),t)}},k=async e=>{if(void 0===u)return;let t={action:"set-slide-position",sessionId:n.id,ticks:Date.now(),parameters:{indexh:e,originator:p}};await b(v.postFacilitatorAction(u.access_token,h,t))};return(0,i.jsx)(d.Provider,{value:{slideData:x,setSlideData:m,slideIndex:f,setSlideIndex:g},children:e.children})}},93191:function(e,t,n){n.d(t,{N:function(){return l},Z:function(){return c}});var i=n(57437),o=n(57818),r=n(2265),s=n(5085),a=n(30496);let l=(0,r.createContext)({});function c(e){let t=(0,r.useContext)(a.F),[c,d]=(0,r.useState)(),{role:u}=(0,r.useContext)(s.rZ);return(0,r.useEffect)(()=>{let r=(0,o.default)(()=>Promise.all([n.e(6885),n.e(9589),n.e(441)]).then(n.bind(n,50441)),{loadableGenerated:{webpack:()=>[50441]},ssr:!1}),s=(0,o.default)(()=>Promise.all([n.e(1518),n.e(8218),n.e(9589),n.e(9974),n.e(567)]).then(n.bind(n,90567)),{loadableGenerated:{webpack:()=>[90567]},ssr:!1});d({presentation:(0,i.jsx)(r,{sid:t.sid,role:u,slides:t.slides,sourcePresentationXml:t.sourceXml.join("\n"),embedded:!0,showBorder:!1,regenerateThumbnails:e.refresh}),previews:e.previews?(0,i.jsx)(s,{sid:t.sid,slides:t.slides,sourcePresentationXml:t.sourceXml.join("\n"),regenerateThumbnails:e.refresh}):void 0})},[]),(0,i.jsx)(i.Fragment,{children:c&&(0,i.jsx)(l.Provider,{value:c,children:e.children})})}},30496:function(e,t,n){n.d(t,{F:function(){return tW},Z:function(){return tK}});var i,o,r,s,a,l,c,d,u=n(57437),h=n(53463),p=n(2265),x=n(22599),m=n.n(x),f=n(20920),g=n(79418),y=n(94547),b=n(4087),v=n(8260),j=n(5085),w=n(31193),k=n(96537),Z=n(48620);function S(e){var t;let n=(0,p.useContext)(j.rZ),{answers:i}=(0,v.ZP)(e.qids.qid),[o,r]=(0,p.useState)((0,v.Zp)(i,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[s,a]=(0,p.useState)(o),[l,c]=(0,p.useState)(n.role!==y._b.Controller),[d,h]=(0,p.useState)(!1);(0,p.useEffect)(()=>{a(o)},[o]);let x=t=>{if(!l)return;h(!0);let n={...s,jsonValue:{answers:[{key:t,booleanValue:!0}]}};e.onAnswer(n).then(e=>{if(e)r(e);else throw"No response from submission"}).catch(e=>{console.error(e)}).finally(()=>{h(!1)})};return(0,u.jsxs)(u.Fragment,{children:[e.question&&(0,u.jsx)(Z.Z,{content:e.question}),(0,u.jsx)(w.Z,{sx:{display:"flex",flexDirection:"row",gap:1,justifyContent:e.align},children:e.options.map((t,n)=>{var i;return(0,u.jsx)(k.Z,{variant:(null!==(i=t.variant)&&void 0!==i?i:0===n)?"contained":"outlined",color:t.colour,onClick:()=>x(t.key),disabled:!l||d,children:t.text},"ack-".concat(e.qids.qid,"-option-").concat(t.key))})})]})}var C=n(22960),D=n(58433),I=n(80511),E=n(33351),A=n(49752);function q(e){let t=e.layoutParams.length>0?parseInt(e.layoutParams[0]):6,n=(0,C.Z)();return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(E.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,u.jsx)(E.Z,{sx:{mb:4,mx:8},children:e.question&&(0,u.jsx)(Z.Z,{content:e.question})}),(0,u.jsx)(D.ZP,{container:!0,spacing:1,children:e.displayOptions.map((i,o)=>{let r=e.currentlySelectedKeys.find(e=>e===i.key);return(0,u.jsx)(D.ZP,{item:!0,xs:t,display:"flex",flexDirection:"column",alignContent:"stretch",children:(0,u.jsx)(k.Z,{variant:"contained",style:{display:"flex",flexDirection:"column",justifyContent:"center",border:"solid 4px",background:r?n.palette.optionButtonSelected.main:n.palette.optionButtonUnselected.main,borderColor:r?n.palette.optionButtonSelectedBorder.main:"transparent",color:"black"},onClick:()=>e.onSelectionClick(i.key),children:(0,u.jsx)(I.Z,{variant:"submitButton",children:i.display})})},"answer-".concat(e.qid,"-").concat(i.key))})}),e.showSubmit&&(0,u.jsx)(E.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-end",sx:{mt:4},children:(0,u.jsx)(A.Z,{busy:e.busy,inline:!1,enabled:e.enableSubmit,onSubmit:e.onSubmit})})]})})}function P(e){let t=(0,C.Z)();return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(E.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,u.jsx)(E.Z,{sx:{mb:4,mx:8},children:e.question&&(0,u.jsx)(Z.Z,{content:e.question})}),(0,u.jsx)(E.Z,{sx:{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",gap:1},children:e.displayOptions.map((n,i)=>{let o=e.currentlySelectedKeys.find(e=>e===n.key);return(0,u.jsx)(k.Z,{variant:"contained",style:{display:"flex",flexDirection:"column",justifyContent:"center",border:"solid 4px",background:o?t.palette.optionButtonSelected.main:t.palette.optionButtonUnselected.main,borderColor:o?t.palette.optionButtonSelectedBorder.main:"transparent",color:"black"},onClick:()=>e.onSelectionClick(n.key),children:(0,u.jsx)(I.Z,{variant:"submitButton",children:n.display})},"answer-".concat(e.qid,"-").concat(n.key))})}),e.showSubmit&&(0,u.jsx)(E.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-end",sx:{mt:4},children:(0,u.jsx)(A.Z,{busy:e.busy,inline:!1,enabled:e.enableSubmit,onSubmit:e.onSubmit})})]})})}function T(e){let t=(0,C.Z)(),n=90-90/e.sourceOptions.filter(e=>!e.isAlt).length;return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,u.jsx)(w.Z,{sx:{mb:4,mx:8},children:e.question&&(0,u.jsx)(Z.Z,{content:e.question})}),(0,u.jsx)(w.Z,{display:"flex",flexDirection:"row",justifyContent:"center",sx:{gap:1,width:"".concat(n,"%")},children:e.displayOptions.filter(e=>!e.isAlt).map((n,i)=>{let o=e.currentlySelectedKeys.find(e=>e===n.key);return(0,u.jsxs)(w.Z,{sx:{borderRadius:4,px:1,flexGrow:1,flexBasis:0},style:{minHeight:200,border:"solid 4px",background:o?t.palette.optionButtonSelected.main:t.palette.optionButtonUnselected.main,borderColor:o?t.palette.optionButtonSelectedBorder.main:"transparent",cursor:"pointer"},display:"flex",flexDirection:"column",justifyContent:"center",onClick:()=>e.onSelectionClick(n.key),children:[!!n.graphic&&(0,u.jsx)("img",{src:n.graphic,style:{alignSelf:"center",width:"40%"},alt:"".concat(n.display)}),(0,u.jsx)(I.Z,{variant:"yesNoUnsureButton",sx:{textWrap:"pretty"},children:n.display})]},"option-".concat(n.key,"-").concat(e.qid))})}),(0,u.jsx)(w.Z,{display:"flex",flexDirection:"column",alignItems:"center",sx:{mt:2},children:e.sourceOptions.filter(e=>e.isAlt).map((n,i)=>{let o=e.currentlySelectedKeys.find(e=>e===n.key);return(0,u.jsx)(w.Z,{sx:{p:2,borderRadius:4},style:{background:o?t.palette.optionButtonSelected.main:"transparent",border:"solid 4px transparent",borderColor:o?t.palette.optionButtonSelectedBorder.main:"transparent",cursor:"pointer"},onClick:()=>e.onSelectionClick(n.key),display:"flex",flexDirection:"column",justifyContent:"center",children:(0,u.jsx)(I.Z,{variant:"yesNoUnsureButton",style:{borderBottom:"solid 1px black"},children:n.display})},"option-".concat(n.key,"-").concat(e.qid))})}),e.showSubmit&&(0,u.jsx)(w.Z,{display:"flex",flexDirection:"row",justifyContent:"center",sx:{mt:4},children:(0,u.jsx)(A.Z,{busy:e.busy,inline:!1,enabled:e.enableSubmit,onSubmit:e.onSubmit})})]})})}let _=(e,t)=>t.filter(t=>!!e.find(e=>e===t.key)),F=e=>[...e].sort(()=>Math.random()-.5);function R(e){var t;let[n,i]=(0,p.useState)(e.shuffle?F(e.options):e.options),{answers:o}=(0,v.ZP)(e.qids.qid),[r,s]=(0,p.useState)((0,v.Zp)(o,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[a,l]=(0,p.useState)([]);(0,p.useEffect)(()=>{var t,n;l(_(null!==(n=null===(t=r.jsonValue)||void 0===t?void 0:t.answers.filter(e=>!0===e.booleanValue).map(e=>e.key))&&void 0!==n?n:[],e.options))},[r]);let[c,d]=(0,p.useState)(!1),h=e.role===y._b.Client,x=()=>a.length>=e.minSelections&&a.length<=e.maxSelections,m=async()=>{if(x())try{d(!0);var t={...r,jsonValue:{answers:a.map(t=>({key:t.key,booleanValue:!0,numericValue:1,index:e.options.findIndex(e=>e.key===t.key)}))}},n=await e.onAnswer(t);if(console.debug("Answer submitted ".concat(n?"ok":"error")),console.debug("Received answer response",n),n)s(n);else throw"No response received"}catch(e){console.error("Error submitting answer",e)}finally{d(!1)}},f=t=>{console.debug("Selection clicked: "+t);let n=e.options.find(e=>e.key===t);if(void 0===n)throw"Cannot identify this option from props.options";if(a.find(e=>e.key===t))l(a.filter(e=>e.key!==t));else if(a.length>=e.maxSelections){let e=a.find(e=>e.key!==t);l([...a.filter(t=>t!==e),n])}else l([...a,n])},g=()=>({onSubmit:m,onSelectionClick:f,qid:e.qids.qid,question:e.question,sourceOptions:e.options,displayOptions:n,busy:c,showSubmit:h,enableSubmit:x(),minSelections:e.minSelections,maxSelections:e.maxSelections,currentlySelectedKeys:a.map(e=>e.key),layoutParams:e.layoutParams}),[b,j]=(0,p.useState)(g());return(0,p.useEffect)(()=>{j(g())},[c,a]),(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:(0,u.jsxs)(w.Z,{sx:{flexGrow:1,display:"block"},children:["yes-no-unsure"===e.layout&&(0,u.jsx)(T,{...b}),"button-grid"===e.layout&&(0,u.jsx)(q,{...b}),"buttons-inline"===e.layout&&(0,u.jsx)(P,{...b})]})})})}var B=n(44908),U=n(11929),V=n(19309);function M(e){return(0,u.jsxs)(w.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,u.jsx)(w.Z,{sx:{display:"block",flexGrow:1,overflowY:"auto",overflowX:"hidden"},children:e.children}),(e.startBar||e.endBar)&&(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[(0,u.jsx)(w.Z,{children:e.startBar}),e.endBar&&(0,u.jsx)(w.Z,{children:e.endBar})]})]})}var N=n(9646);function O(e){var t;let n=(0,p.useContext)(j.rZ),{answers:i}=(0,v.ZP)(e.qids.qid),[o,r]=(0,p.useState)((0,v.Zp)(i,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[s,a]=(0,p.useState)(!1),[l,c]=(0,p.useState)(!1),[d,h]=(0,p.useState)(!1);(0,p.useEffect)(()=>{var e,t,n;a(null!==(n=null===(t=o.jsonValue)||void 0===t?void 0:null===(e=t.answers.find(e=>"consent"===e.key))||void 0===e?void 0:e.booleanValue)&&void 0!==n&&n)},[o]),(0,p.useEffect)(()=>{c(s&&n.role===y._b.Client)},[s]);let x=t=>{if(!l){console.warn("Only participants can submit answers");return}h(!0);let n={...o,jsonValue:{answers:[{key:"consent",booleanValue:s},{key:"consentText",stringValue:e.consentText}]}};e.onAnswer(n).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),null!==e)r(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{h(!1)})};return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(M,{startBar:(0,u.jsx)(()=>(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(B.Z,{control:(0,u.jsx)(U.Z,{checked:s,onChange:(e,t)=>a(t)}),label:(0,u.jsx)("span",{style:{fontWeight:"bold",fontSize:"1.25rem"},children:e.consentText})})}),{}),endBar:(0,u.jsx)(()=>(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(N.Z,{btnKey:"submit",btnText:(0,u.jsx)(b.Z,{i18nKey:"button.submit"}),onClick:x,disabled:!l,busy:d})}),{}),children:[e.question&&(0,u.jsx)(Z.Z,{content:e.question,forceAlign:"left",sx:{fontWeight:"bold"}}),e.content.map((t,n)=>(0,u.jsx)(I.Z,{variant:"consentBody",align:"left",dangerouslySetInnerHTML:{__html:(0,V.Z)(t)}},"".concat(e.qids.qid,"-consent-body-").concat(n)))]})})}let W={gbr:{key:"postcode",label:"Postcode (first half)",mode:"text",layout:"column",textPlaceholder:"What is the first half of your postcode?",textValidationRegex:"^[a-zA-Z]{1,2}[0-9][0-9a-zA-Z]?$",textCapitalisation:!0,textValidationMessage:"Please enter a valid UK postcode",groups:[]}},K={key:"gender",label:"Gender",mode:"select",layout:"column",groups:[{label:"Gender",choices:[{display:"Female",key:"f"},{display:"Male",key:"m"},{display:"Non-binary",key:"nb"},{display:"I would rather not say",key:"prefer-not-to-say"}]}]},L={key:"age",label:"Age range",mode:"select",layout:"grid",layoutProps:{columns:2},groups:[{label:"Age",choices:[{display:"14 - 17",key:"14-17"},{display:"18 - 25",key:"18-25"},{display:"26 - 35",key:"26-35"},{display:"36 - 45",key:"36-45"},{display:"46 - 55",key:"46-55"},{display:"56 - 65",key:"56-65"},{display:"66 - 75",key:"66-75"},{display:"76+",key:"76+"},{display:"I would rather not say",key:"prefer-not-to-say"}]}]},z={key:"ethnicity",label:"Ethnicity",mode:"select",layout:"row",groups:[{label:"Asian or Asian British",choices:[{display:"Indian",key:"Indian"},{display:"Pakistani",key:"Pakistani"},{display:"Bangladeshi",key:"Bangladeshi"},{display:"Chinese",key:"Chinese"},{display:"Any other Asian background",key:"Any other Asian background"}]},{label:"Black, Black British, Caribbean or African",choices:[{display:"Caribbean",key:"Caribbean"},{display:"African",key:"African"},{display:"Any other Black, Black British, or Caribbean background",key:"Any other Black, Black British, or Caribbean background"}]},{label:"Mixed or multiple ethnic groups",choices:[{display:"White and Black Caribbean",key:"White and Black Caribbean"},{display:"White and Black African",key:"White and Black African"},{display:"White and Asian",key:"White and Asian"},{display:"Any other Mixed or multiple ethnic background",key:"Any other Mixed or multiple ethnic background"}]},{label:"White",choices:[{display:"English, Welsh, Scottish, Northern Irish or British",key:"English, Welsh, Scottish, Northern Irish or British"},{display:"Irish",key:"Irish"},{display:"Gypsy or Irish Traveller",key:"Gypsy or Irish Traveller"},{display:"Roma",key:"Roma"},{display:"Any other White background",key:"Any other White background"}]},{label:"Other ethnic group",choices:[{display:"Arab",key:"Arab"},{display:"Any other ethnic group",key:"Any other ethnic group"}]},{label:"Unavailable",choices:[{display:"I would rather not say",key:"prefer-not-to-say"}]}]};function G(e){let t=e.demographic.groups.length>1;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[(0,u.jsx)(k.Z,{color:"buttonStandard",variant:"text",onClick:()=>e.onBack(),children:(0,u.jsx)("img",{src:"/icons/arrow-left.svg",alt:"Back"})}),(0,u.jsx)(I.Z,{variant:"slideSubHeading",align:"left",children:e.demographic.label})]}),(0,u.jsx)(w.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"stretch",gap:4,mb:4},children:e.demographic.groups.map(n=>(0,u.jsxs)(w.Z,{display:"flex",flexDirection:"column",alignContent:"start",children:[t&&(0,u.jsx)(I.Z,{variant:"demographicGroupHeading",align:"left",sx:{mb:.8},children:n.label}),("row"===e.layout||"column"===e.layout)&&(0,u.jsx)(w.Z,{display:"flex",flexDirection:e.layout,gap:1,flexWrap:"row"===e.layout?"wrap":void 0,alignItems:"column"===e.layout?"start":void 0,children:n.choices.map(t=>{var i;return(0,u.jsx)(k.Z,{variant:"contained",color:(null===(i=e.currentSelection)||void 0===i?void 0:i.key)===t.key?"buttonStandard":"buttonQuiet",onClick:()=>{e.onSelection(t)},children:(0,u.jsx)(I.Z,{variant:"submitButton",children:t.display})},"".concat(e.demographic.label,"-section-").concat(n.label,"-value-").concat(t.key))})}),"grid"===e.layout&&(0,u.jsx)(D.ZP,{container:!0,sx:{width:e.layoutProps.columns<3?"66%":"100%"},rowGap:1,children:n.choices.map(t=>{var i;return(0,u.jsx)(D.ZP,{item:!0,xs:12/e.layoutProps.columns,sx:{px:1},children:(0,u.jsx)(k.Z,{variant:"contained",fullWidth:!0,color:(null===(i=e.currentSelection)||void 0===i?void 0:i.key)===t.key?"buttonStandard":"buttonQuiet",onClick:()=>{e.onSelection(t)},children:(0,u.jsx)(I.Z,{variant:"submitButton",sx:{py:1},children:t.display})})},"".concat(e.demographic.label,"-section-").concat(n.label,"-value-").concat(t.key))})})]},"".concat(e.demographic.label,"-section-").concat(n.label)))})]})}var H=n(66858);function J(e){var t,n,i;let o=()=>{var t;return null!==(t=e.skipOption)&&void 0!==t?t:{key:"prefer-not-to-say",display:"I would rather not say"}},[r,s]=(0,p.useState)((null===(t=e.currentSelection)||void 0===t?void 0:t.key)!==o().key&&null!==(i=null===(n=e.currentSelection)||void 0===n?void 0:n.display)&&void 0!==i?i:""),[a,l]=(0,p.useState)(""),[c,d]=(0,p.useState)(!1),[h,x]=(0,p.useState)(!0),[m,f]=(0,p.useState)(!1),g=t=>{var n,i;return(f(!0),e.demographic.textMaxLength&&t.length>e.demographic.textMaxLength)?(l(null!==(n=e.demographic.textValidationMessage)&&void 0!==n?n:"Maximum length: ".concat(e.demographic.textMaxLength," characters")),d(!0),x(!1),!1):e.demographic.textValidationRegex&&!new RegExp(e.demographic.textValidationRegex).test(t)?(s(t),l(null!==(i=e.demographic.textValidationMessage)&&void 0!==i?i:"Please enter a valid value for ".concat(e.demographic.label,".")),d(!0),x(!1),!1):(s(t),l(""),d(!1),x(!0),!0)};return(0,p.useEffect)(()=>{m&&x(!c)},[m,c]),(0,u.jsx)(M,{endBar:(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",gap:1},children:[e.skipPermitted&&(0,u.jsx)(N.Z,{btnKey:"skip",btnText:"I would rather not say",variant:"outlined",onClick:t=>{e.onSelection(o())}}),(0,u.jsx)(N.Z,{btnKey:"submit",btnText:"Submit",variant:"contained",disabled:!h,onClick:t=>{g(r)&&e.onSelection({key:r,display:r})}})]}),children:(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[(0,u.jsx)(k.Z,{color:"buttonStandard",variant:"text",onClick:()=>e.onBack(),children:(0,u.jsx)("img",{src:"/icons/arrow-left.svg",alt:"Back"})}),(0,u.jsx)(I.Z,{variant:"slideSubHeading",align:"left",children:e.demographic.label})]}),(0,u.jsx)(H.Z,{label:e.demographic.textPlaceholder,variant:"outlined",defaultValue:r,onChange:e=>{let t=e.target.value.trim();m?g(t):s(t)},helperText:a,error:c,autoComplete:"off",color:"buttonStandard",inputProps:{style:{textTransform:e.demographic.textCapitalisation?"uppercase":void 0}},InputProps:{sx:{background:"white",fontSize:"2rem"}},InputLabelProps:{sx:{fontSize:"2rem","&.MuiOutlinedInput-notchedOutline":{fontSize:"2rem"}}}})]})})}function Y(e){var t,n,i,o;let r;let{answers:s}=(0,v.ZP)(e.qids.qid),[a,l]=(0,p.useState)((0,v.Zp)(s,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[c,d]=(0,p.useState)(!1),[h,x]=(0,p.useState)(!1),[f,g]=(0,p.useState)((r=[],(null===(n=e.showGender)||void 0===n||n)&&r.push(K),(null===(i=e.showAge)||void 0===i||i)&&r.push(L),(null===(o=e.showEthnicity)||void 0===o||o)&&r.push(z),void 0!==e.showPostcode&&r.push(W[e.showPostcode]),[...r,...e.customDemographics])),[j,S]=(0,p.useState)(),[C,D]=(0,p.useState)({});(0,p.useEffect)(()=>{let e={};(null==a?void 0:a.jsonValue)&&a.jsonValue.answers.forEach(t=>{e[t.key]={key:t.optionKey,display:t.stringValue}}),D(e)},[a]),(0,p.useEffect)(()=>{let t=m().every(f,e=>C.hasOwnProperty(e.key));x(e.role===y._b.Client&&t)},[C]);let E=async()=>{if(e.role!==y._b.Client)console.warn("Only participants can submit answers");else{let t={...a,jsonValue:{answers:Object.entries(C).map(e=>({key:e[0],optionKey:e[1].key,stringValue:e[1].display}))}};d(!0),e.onAnswer(t).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)l(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{d(!1)})}},A=!1===e.opaqueInputBox?void 0:{background:"white"},q=e=>{var t;return(0,u.jsx)(k.Z,{color:"buttonStandard",variant:"outlined",sx:{alignSelf:"stretch",py:0,...e.inputBoxSx},onClick:()=>e.onClick(),children:(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",flexGrow:1,justifyContent:"space-between"},children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:0},children:[void 0!==e.display&&(0,u.jsx)(I.Z,{variant:"selectTiny",children:e.label}),(0,u.jsx)(I.Z,{variant:"selectLarge",component:"div",children:null!==(t=e.display)&&void 0!==t?t:e.label})]}),(0,u.jsx)("img",{src:"/icons/select-down.svg"})]})})};return(0,u.jsxs)(u.Fragment,{children:[void 0===j&&(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(M,{endBar:(0,u.jsx)(N.Z,{btnKey:"submit",btnText:(0,u.jsx)(b.Z,{i18nKey:"button.submit"}),onClick:()=>{E()},disabled:!h,busy:c}),children:(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,u.jsx)(w.Z,{sx:{mb:4,mx:8},children:e.question&&(0,u.jsx)(Z.Z,{content:e.question})}),f.map(e=>(0,u.jsx)(q,{label:e.label,display:C.hasOwnProperty(e.key)?C[e.key].display:void 0,onClick:()=>{S(e)},inputBoxSx:A},"overview-demographic-".concat(e.key)))]})})}),void 0!==j&&"select"===j.mode&&(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(G,{demographic:j,currentSelection:C[j.key],onBack:()=>{S(void 0)},onSelection:e=>{D({...C,[j.key]:e}),S(void 0)},layout:j.layout,layoutProps:j.layoutProps})}),void 0!==j&&"text"===j.mode&&(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(J,{demographic:j,skipPermitted:!0,currentSelection:C[j.key],onBack:()=>{S(void 0)},onSelection:e=>{D({...C,[j.key]:e}),S(void 0)}})})]})}var X=n(83593);function Q(e){let{answers:t}=(0,v.ZP)(e.qids.qid),n=()=>(0,v.UJ)(t,e.qids),[i,o]=(0,p.useState)(n()),[r,s]=(0,p.useState)((0,v.S9)(i)?1:0);return(0,p.useEffect)(()=>{o(n())},[t]),(0,p.useEffect)(()=>{s((0,v.S9)(i)?1:0)},[i]),(0,p.useEffect)(()=>{X.Z.emit({type:X.M.Request_SlideRefresh})},[r]),(0,u.jsxs)(u.Fragment,{children:[0===r&&e.input,1===r&&e.completion]})}(i=a||(a={}))[i.Input=0]="Input",i[i.Completion=1]="Completion";var $=n(40772),ee=n(14874);function et(e){let{allAnswers:t}=(0,v.ZP)(),n=()=>{for(let n of e.qids)if(!(0,v.S9)((0,v.UJ)(t[n.qid],n)))return e.qids.indexOf(n)},[i,o]=(0,p.useState)(n());(0,p.useEffect)(()=>{let e=n();i!==e&&o(e)},[t]);let r=(0,ee.Z)(),s=[.2,.25],[a]=(0,$.u)({duration:500});return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{ref:a,className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"stretch",p:2,gap:2,boxSizing:"border-box"},children:[void 0!==i&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(Z.Z,{content:e.question}),(0,u.jsx)(w.Z,{sx:{flexGrow:1,boxSizing:"border-box",overflowY:"auto",overflowX:"hidden",display:"block"},children:e.inputs[i]},"input-sequence-element-".concat(e.qids[i].qid))]}),void 0===i&&(0,u.jsx)(w.Z,{sx:{flexGrow:1,display:"block"},children:e.completion}),void 0!==i&&e.showProgress&&(0,u.jsx)(w.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:m().range(0,e.inputs.length).map((t,n)=>(0,u.jsx)(w.Z,{sx:{background:t===i?r.palette.progressBlipSelected.main:r.palette.progressBlipUnselected.main,width:"".concat(s[t===i?1:0],"em"),height:"".concat(s[t===i?1:0],"em"),borderRadius:"".concat(s[t===i?1:0]/2,"em")}},"sequence-blip-".concat(t,"-").concat(e.qids[t].qid)))})]})})}var en=n(26049);function ei(e){let{answers:t}=(0,v.ZP)(e.qids.qid),n=()=>{var n;return(0,v.Zp)(t,e.qids,null===(n=e.question)||void 0===n?void 0:n.pii)},[i,o]=(0,p.useState)(n()),[r,s]=(0,p.useState)(n()),[a,l]=(0,p.useState)(!1),[c,d]=(0,p.useState)(e.role===y._b.Client),[h,x]=(0,p.useState)({});(0,p.useEffect)(()=>{let t={...h};e.options.forEach(n=>{var o,r,s;t[n.key]=null!==(s=null===(r=i.jsonValue)||void 0===r?void 0:null===(o=r.answers.find(e=>e.key===n.key))||void 0===o?void 0:o.numericValue)&&void 0!==s?s:Math.floor((e.min+e.max)/2)}),x(t),s({...i,jsonValue:{answers:e.options.map(n=>{var i,o;return{key:n.key,numericValue:null!==(i=t[n.key])&&void 0!==i?i:Math.floor((e.min+e.max)/2),description:n.description,index:null!==(o=t[n.key])&&void 0!==o?o:Math.floor((e.min+e.max)/2)}})}})},[i]);let m=t=>h.hasOwnProperty(t)?h[t]:Math.floor((e.min+e.max)/2),f=(t,n)=>{var i,o,a;let l=null!==(o=r.jsonValue)&&void 0!==o?o:{answers:[]};l.answers=l.answers.filter(e=>e.key!==t),l.answers.push({key:t,numericValue:n,description:null!==(a=null===(i=e.options.find(e=>e.key===t))||void 0===i?void 0:i.description)&&void 0!==a?a:"".concat(n),index:n}),s({...r,jsonValue:l})},g=async()=>{e.role!==y._b.Controller&&(l(!0),e.onAnswer(r).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)o(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{l(!1)}))};return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1,px:8},children:[(0,u.jsxs)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1,overflowX:"hidden",overflowY:"auto",justifyContent:"center",px:0},children:[(0,u.jsx)(w.Z,{sx:{mb:8},children:e.question&&(0,u.jsx)(Z.Z,{content:e.question})}),(0,u.jsxs)(D.ZP,{container:!0,sx:{alignItems:"center"},children:[(0,u.jsx)(D.ZP,{item:!0,xs:3}),(0,u.jsx)(D.ZP,{item:!0,xs:9,style:{textAlign:"left"},sx:{pr:3},children:e.labels.map((t,n)=>{let i=e.max-e.min,o=t.at-e.min,r=t.at===e.min,s=t.at===e.max;return(0,u.jsx)(w.Z,{style:{position:"relative",left:"".concat(o/i*100,"%")},children:(0,u.jsx)(w.Z,{style:{position:"absolute",transform:r?"translate(0, -0.5em)":s?"translate(-100%, -0.5em)":"translate(-50%, -0.5em)",maxWidth:"".concat(100/e.labels.length,"%")},children:(0,u.jsx)(I.Z,{variant:"body1",component:"div",sx:{fontWeight:"bold"},children:t.text})})},"".concat(e.qids.qid,"-label-").concat(n,"-at-").concat(t.at))})}),e.options.map((t,n)=>(0,u.jsxs)(p.Fragment,{children:[(0,u.jsxs)(D.ZP,{item:!0,xs:3,children:[(0,u.jsx)(I.Z,{variant:"body1",align:"left",component:"div",sx:{pr:6},children:t.title}),e.showDescriptions&&!1]}),(0,u.jsx)(D.ZP,{item:!0,xs:9,sx:{pr:3},children:(0,u.jsx)(en.Z,{onCommit:e=>{f(t.key,e)},color:"secondary",sliderDefault:m(t.key),marks:!0,min:e.min,max:e.max,step:1,sliderMode:"multi",sx:{mt:1}})})]},"".concat(e.qids.qid,"-option-").concat(t.key)))]})]}),e.role===y._b.Client&&(0,u.jsx)(w.Z,{children:(0,u.jsx)(A.Z,{onSubmit:g,text:(0,u.jsx)(b.Z,{i18nKey:"button.submit"}),busy:a,enabled:c,inline:!1,alignment:"right"})})]})})}var eo=n(45231);function er(e){let t=(0,p.useContext)(j.rZ),{answers:n}=(0,v.ZP)(e.qids.qid),i=()=>{var t;return(0,v.Zp)(n,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)},[o,r]=(0,p.useState)(i()),[s,a]=(0,p.useState)(i()),[l,c]=(0,p.useState)(!1),[d,h]=(0,p.useState)(!1),[x,f]=(0,p.useState)(e.points),[g,k]=(0,p.useState)(e.options.map(e=>({min:0,max:e.max}))),[S,D]=(0,p.useState)(e.options.map(()=>0)),E=(e,t)=>{D(S.map((n,i)=>i===t?e:n))};(0,p.useEffect)(()=>{let n=e.points-m().sum(S);f(n);for(let t=0;t<e.options.length;t++)k(g.map((e,t)=>({min:0,max:S[t]+n})));let i={answers:[]};for(let t=0;t<e.options.length;t++)i.answers.push({key:e.options[t].key,description:e.options[t].title,numericValue:S[t]});a({...s,jsonValue:i}),h(0===n&&t.role!==y._b.Controller)},[S,e.options,e.points,t.role]);let q=async()=>{c(!0),e.onAnswer(s).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)r(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{c(!1)})},P=(e,t)=>m().range(e,t+1,1).map((e,t)=>({value:e,label:"".concat(e)})),T=(0,C.Z)();return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,u.jsx)(w.Z,{sx:{display:"flex",flexDirection:"row",gap:1,mb:2},children:e.question&&(0,u.jsx)(Z.Z,{content:e.question})}),(0,u.jsx)(w.Z,{sx:{display:"flex",flexDirection:"column",gap:1,flexGrow:1,overflowX:"hidden",overflowY:"auto",px:1},children:e.options.map((e,n)=>(0,u.jsxs)(w.Z,{sx:{background:"#f0f0f0",p:2,borderRadius:4,display:"flex",flexDirection:"row",alignItems:"stretch",gap:2},children:[e.graphic&&(0,u.jsx)(w.Z,{sx:{width:"20%",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url(".concat(e.graphic,")"),borderRadius:2}}),(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"column",gap:1,width:"80%"},children:[(0,u.jsx)(I.Z,{variant:"pointsAllocationCategoryTitle",align:"left",children:e.title}),(0,u.jsx)(I.Z,{variant:"pointsAllocationCategoryDescription",align:"left",children:e.description}),(0,u.jsx)(w.Z,{sx:{px:2},children:(0,u.jsx)(en.Z,{onCommit:e=>{E(e,n)},color:"secondary",sliderDefault:S[n],marks:P(e.min,e.max),slots:{markLabel:eo.A},min:e.min,max:e.max,step:1,sliderMode:"multi",acceptableRange:{min:g[n].min,max:g[n].max},disabled:t.role===y._b.Controller})})]})]},"points-allocation-option-".concat(n)))}),(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"end",gap:1,mx:1},children:[(0,u.jsx)(I.Z,{variant:"pointsAllocationCategoryTitle",align:"left",color:T.palette.secondary.main,children:(0,u.jsx)(b.Z,{i18nKey:"poll.pointsAllocation.remaining",options:{numberOfPoints:x}})}),(0,u.jsx)(A.Z,{enabled:d,inline:!0,busy:l,onSubmit:()=>q()})]})]})})}var es=n(11020),ea=n(84479);let el=(e,t,n)=>{if(void 0===e.jsonValue||0===e.jsonValue.answers.length)return ed(t,n);let i=[];return e.jsonValue.answers.forEach(e=>{let n=t.find(t=>t.key===e.key);n&&(i[e.index]=n)}),i},ec=(e,t)=>{let n={answers:[]};return t.forEach((e,t)=>{n.answers.push({key:e.key,index:t,numericValue:t,description:e.title})}),{...e,jsonValue:n}},ed=(e,t)=>t?[...e].sort(()=>Math.random()-.5):e.sort((e,t)=>e.startingIndex-t.startingIndex);function eu(e){var t;let n=(0,p.useContext)(j.rZ),{answers:i}=(0,v.ZP)(e.qids.qid),[o,r]=(0,p.useState)((0,v.Zp)(i,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[s,a]=(0,p.useState)(n.role!==y._b.Controller),[l,c]=(0,p.useState)(!1),[d,h]=(0,p.useState)(ed(e.options,e.shuffle));(0,p.useEffect)(()=>{h(el(o,e.options,e.shuffle))},[o,e.options,e.shuffle]);let x=e=>{let t=d.findIndex(t=>t.key===e.key);if(t>0){let n=[...d];n.splice(t,1),n.splice(t-1,0,e),h(n)}},m=e=>{let t=d.findIndex(t=>t.key===e.key);if(t<d.length-1){let n=[...d];n.splice(t,1),n.splice(t+1,0,e),h(n)}},f=async()=>{if(n.role===y._b.Client&&s){c(!0);let t=ec(o,d);e.onAnswer(t).then(t=>{if(console.debug("Answer submitted ".concat(t?"ok":"error")),console.debug("Received answer response",t),null!==t)h(el(t,e.options,e.shuffle));else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{c(!1)})}else console.warn("Only participants can submit answers")},g=(0,C.Z)(),[k]=(0,$.u)({duration:500});return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(M,{endBar:(0,u.jsx)(N.Z,{btnKey:"submit",onClick:e=>{f()},disabled:!s,busy:l,variant:"contained",color:"buttonStandard",btnText:(0,u.jsx)(b.Z,{i18nKey:"button.submit"})}),children:[e.question&&(0,u.jsx)(w.Z,{sx:{mb:2},children:(0,u.jsx)(Z.Z,{content:e.question})}),(0,u.jsx)(w.Z,{ref:k,sx:{display:"flex",flexDirection:"column"},children:d.map((t,n)=>(0,u.jsxs)(w.Z,{sx:{border:"solid 1px black",borderRadius:2,p:1.5,display:"flex",flexDirection:"row",gap:1,alignContent:"center",alignItems:"center",background:"white",mb:1,boxSizing:"border-box"},children:[(0,u.jsxs)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",pr:2},children:[t.title&&(0,u.jsx)(I.Z,{variant:"rankedListItemTitle",align:"left",children:t.title}),t.description&&(0,u.jsx)(I.Z,{variant:"rankedListItemDescription",align:"left",children:t.description})]}),(0,u.jsx)(w.Z,{onClick:()=>{x(t)},sx:{display:"flex",flexDirection:"column",background:g.palette.updinkBackground.main,color:g.palette.updinkText.main,p:.5,borderRadius:2,cursor:0===n?void 0:"pointer",opacity:0===n?0:1},children:(0,u.jsx)(ea.Z,{sx:{fontSize:"2rem"}})}),(0,u.jsx)(w.Z,{onClick:()=>{m(t)},sx:{display:"flex",flexDirection:"column",background:g.palette.downdinkBackground.main,color:g.palette.downdinkText.main,p:.5,borderRadius:2,cursor:n===d.length-1?void 0:"pointer",opacity:n===d.length-1?0:1},children:(0,u.jsx)(es.Z,{sx:{fontSize:"2rem"}})})]},"ranked-list-".concat(e.qids.qid,"-option-").concat(t.key)))})]})})}var eh=n(71359),ep=n(45080),ex=n(34990),em=n(60335);(o=l||(l={}))[o.Yes=0]="Yes",o[o.No=1]="No",o[o.Unsure=2]="Unsure";let ef=e=>0===e?1:1===e?-1:0,eg=e=>1===e?0:-1===e?1:2;function ey(e){var t;let{answers:n}=(0,v.ZP)(e.qids.qid),[i,o]=(0,p.useState)((0,v.Zp)(n,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[r,s]=(0,p.useState)(i),[a,c]=(0,p.useState)(!1),d=e.role===y._b.Client;(0,p.useEffect)(()=>{s({...i})},[i]);let h=async e=>{if(d&&!a){let t={...r,jsonValue:{answers:[{key:"vote",stringValue:l[e],numericValue:ef(e)}]}};await x(t)}},x=async t=>{try{c(!0);let n=await e.onAnswer(t);if(null!==n)o(n);else throw"Failed to submit answer"}catch(e){console.error(e)}finally{c(!1)}},m=(0,ee.Z)();return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[(0,u.jsx)(Z.Z,{content:e.question}),(0,u.jsxs)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,u.jsxs)(ex.Z,{elevation:0,sx:{p:4,mb:2,width:"60%",height:"70%",alignSelf:"center",minHeight:200,borderRadius:4,background:m.palette.promptPanelBackground.main,display:"flex",flexDirection:"row",alignContent:"center",justifyContent:"stretch"},children:[(0,u.jsx)(w.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,u.jsx)("div",{style:{position:"absolute",width:"15%",height:"20%",padding:0,margin:0},children:(0,u.jsx)(em.Z,{sx:{position:"relative",left:"-100%",top:0,width:"100%",height:"100%",m:0,p:0},onClick:()=>h(1),disabled:!d||a,style:{opacity:d&&!a?1:.5},children:(0,u.jsx)("img",{src:"/icons/updown/cross.svg",alt:"False button icon"})})})}),(0,u.jsx)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"center",p:2},children:(0,u.jsx)(I.Z,{variant:"upDownQuestion",sx:{textAlign:"center",alignSelf:"center"},children:e.assertion})}),(0,u.jsx)(w.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,u.jsx)("div",{style:{position:"absolute",width:"15%",height:"20%",padding:0,margin:0},children:(0,u.jsx)(em.Z,{sx:{position:"relative",right:0,top:0,width:"100%",height:"100%",m:0,p:0},style:{opacity:d&&!a?1:.5},onClick:()=>h(0),disabled:!d||a,children:(0,u.jsx)("img",{src:"/icons/updown/check.svg",alt:"True button icon"})})})})]}),(0,u.jsx)(w.Z,{sx:{p:2,borderRadius:4,cursor:"pointer",opacity:d&&!a?1:.5,alignSelf:"center"},onClick:()=>h(2),display:"flex",flexDirection:"column",justifyContent:"center",children:(0,u.jsx)(I.Z,{variant:"submitButton",style:{borderBottom:"solid 1px black"},children:(0,u.jsx)(b.Z,{i18nKey:"poll.upDown.notSure"})})})]})]})})}function eb(e){return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(w.Z,{sx:{display:"flex",flexDirection:"column",gap:2,...e.sx},children:e.children})})}function ev(e){let{sx:t,children:n}=e;return(0,u.jsx)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",...t},children:(0,u.jsx)(w.Z,{alignSelf:"center",display:"inline-block",textAlign:"center",children:n})})}function ej(e){let{sx:t,children:n}=e;return(0,u.jsx)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",overflowY:"auto",overflowX:"hidden",display:"block",...t},children:n})}function ew(e){return(0,u.jsx)("img",{className:"stretch",alt:e.alt,style:{width:"100%",height:"100%",...e.style},src:e.src})}function ek(e){let[t,n]=(0,p.useState)(e.sideSx),[i,o]=(0,p.useState)(e.mainSx);return(0,p.useEffect)(()=>{void 0!==e.sideBackgroundImage&&n({backgroundImage:"url(".concat(e.sideBackgroundImage,")"),...e.sideSx}),void 0!==e.mainBackgroundImage&&o({backgroundImage:"url(".concat(e.mainBackgroundImage,")"),...e.mainSx})},[e.sideBackgroundImage,e.mainBackgroundImage,e.sideSx,e.mainSx]),(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"row"},children:[(0,u.jsx)(w.Z,{sx:{width:"35%",display:"block",...e.sideSx},children:e.side}),(0,u.jsx)(w.Z,{sx:{px:2,alignSelf:"stretch",display:"block",overflowY:"auto",width:"60%",...e.mainSx},children:e.main})]})})}function eZ(e){let t={backgroundImage:"url('".concat(e.src,"')")};return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"block",...t,...e.sx},children:e.children})})}function eS(e){let t={...e.sx,color:e.color};return(0,u.jsx)(I.Z,{variant:e.variant,component:"div",sx:t,align:e.align,children:e.children})}function eC(e){let t=(0,C.Z)(),n=void 0===e.chartBackground||e.chartBackground;return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1,overflowY:"hidden"},children:[e.title&&(0,u.jsx)(eS,{variant:"summaryTitle",sx:{p:0,px:1},align:"left",children:e.title}),e.prompt&&(0,u.jsx)(eS,{variant:"summaryPrompt",sx:{p:0,px:1},align:"left",children:e.prompt}),(0,u.jsx)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"row",gap:1,alignItems:"stretch",overflowY:"hidden"},children:e.children.map((e,i)=>(0,u.jsx)(w.Z,{sx:{background:n?t.palette.summaryChartBackground.main:void 0,borderRadius:n?4:void 0,flexGrow:1,flexBasis:0,p:2,display:"block",overflow:"auto"},children:e},"summary-slide-child-".concat(i)))})]})})}function eD(e){return(0,u.jsx)("img",{src:e.src,style:e.style,alt:e.alt})}function eI(e){var t;let{content:n,sx:i}=e;return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",...i},children:[(0,u.jsx)(I.Z,{variant:"slideHeading",children:null!==(t=n.message)&&void 0!==t?t:"Thanks!"}),n.factoid&&(0,u.jsx)(I.Z,{variant:"slideBody",sx:{mt:8},children:n.factoid})]})})}var eE=n(2962);let eA=e=>{let t=parseInt(e.replace("#",""),16);return[t>>16&255,t>>8&255,255&t]},eq=(e,t,n,i)=>{let o=eA(n),r=eA(i),s=Math.round(o[0]+(r[0]-o[0])*e/t),a=Math.round(o[1]+(r[1]-o[1])*e/t),l=Math.round(o[2]+(r[2]-o[2])*e/t);return"rgb(".concat(s,",").concat(a,",").concat(l,")")},eP=e=>{let t={};return e.forEach(e=>{var n;null===(n=e.jsonValue)||void 0===n||n.answers.forEach(e=>{var n;let i=e.key,o=null!==(n=e.numericValue)&&void 0!==n?n:0;t.hasOwnProperty(i)||(t[i]=0),t[i]+=o})}),t},eT=(e,t)=>Object.entries(eP(e)).map(e=>{var n,i,o;return{key:e[0],title:null!==(o=null===(n=t.find(t=>t.key===e[0]))||void 0===n?void 0:n.title)&&void 0!==o?o:"",description:null===(i=t.find(t=>t.key===e[0]))||void 0===i?void 0:i.description,value:e[1]}});function e_(e){let{answers:t}=(0,v.ZP)(e.qids.qid),[n,i]=(0,p.useState)([]),[o,r]=(0,p.useState)([]),[s,a]=(0,p.useState)([]),l=(0,C.Z)();return(0,p.useEffect)(()=>{i(null!=t?t:[])},[t]),(0,p.useEffect)(()=>{r(eT(n,e.options))},[n,e.options]),(0,p.useEffect)(()=>{var t;let n=l.palette.secondary.main,i=null!==(t=e.mode)&&void 0!==t?t:"normal",r=o.sort((e,t)=>e.value-t.value);"normal"===i&&(r=r.reverse()),a([...r.map((t,i)=>{var r,s;return{backgroundColor:eq(i,o.length,null!==(r=e.startColour)&&void 0!==r?r:n,null!==(s=e.endColour)&&void 0!==s?s:"#FFFFFF"),textColor:"#000000",option:t}})])},[o,e.startColour,e.endColour,l.palette.secondary.main,e.mode]),(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",flexDirection:"column",display:"flex",gap:1},children:[e.question&&(0,u.jsx)(Z.Z,{content:e.question}),(0,u.jsx)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1,justifyContent:"start"},children:s.map((t,n)=>(0,u.jsx)(w.Z,{sx:{backgroundColor:t.backgroundColor,color:t.textColor,borderRadius:2,display:"flex",flexDirection:"column",p:2},children:(0,u.jsxs)(I.Z,{variant:"orderedListItemTitle",align:"left",children:[n+1,". ",t.option.title]})},"ordered-display-".concat(e.qids.qid,"-option-").concat(t.option.key,"-").concat(n)))})]})})}function eF(e){let t=(0,C.Z)(),n=1===e.headings.filter(e=>e.expanded).length;return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[e.question&&(0,u.jsx)(Z.Z,{content:e.question,forceAlign:"left"}),e.headings.map((i,o)=>(0,u.jsxs)(w.Z,{sx:{flexGrow:i.expanded?1:void 0,flexBasis:i.expanded?0:void 0,display:"flex",flexDirection:"row",gap:2,p:2,alignItems:"stretch",backgroundColor:t.palette.summaryChartBackground.main,borderRadius:4},children:[i.expanded&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(w.Z,{sx:{display:"inline-block",borderRadius:2,flexGrow:0,flexShrink:0,flexBasis:n?"50%":"20%",backgroundImage:"url(".concat(i.graphic,")"),backgroundSize:"cover",backgroundPosition:"center",mr:2}}),(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"column",gap:2,alignSelf:"center"},children:[(0,u.jsx)(I.Z,{variant:"sectionHeadingTitle",align:"left",children:i.title}),i.description&&(0,u.jsx)(I.Z,{variant:"sectionHeadingDescription",align:"left",children:i.description})]})]}),!i.expanded&&(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(I.Z,{variant:"sectionHeadingTitleQuiet",align:"left",children:i.title})})]},"section-heading-".concat(e.uid,"-").concat(o)))]})})}function eR(e){let{answers:t}=(0,v.ZP)(e.qids.qid),n=(0,C.Z)();return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",overflowX:"hidden",overflowY:"auto"},children:[e.question&&(0,u.jsx)(Z.Z,{content:e.question}),(0,u.jsx)(w.Z,{display:"flex",flexDirection:"column",alignItems:"center",children:t.map((t,i)=>{var o;return(0,u.jsx)(u.Fragment,{children:null===(o=t.jsonValue)||void 0===o?void 0:o.answers.map(t=>(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(w.Z,{sx:{mb:4,px:2,mx:8},className:"shadow",style:{background:"white",border:"solid 2px",borderColor:i%2==0?n.palette.primary.main:n.palette.secondary.main,borderRadius:12,transform:"rotate(".concat(i%2==0?1.5:-1.5,"deg)")},children:(0,u.jsx)(I.Z,{variant:"slideBody",children:t.stringValue})},"speech-bubble-".concat(e.qids.qid,"-").concat(t.key))}))})})})]})})}var eB=n(73391);let eU=(e,t)=>{if(!e||0===e.length)return[];let n=new Map;return e.forEach(e=>{var t;null===(t=e.jsonValue)||void 0===t||t.answers.forEach(e=>{var t;let i=e.key,o=null!==(t=e.numericValue)&&void 0!==t?t:0;n.has(i)||n.set(i,0),n.set(i,n.get(i)+o)})}),Array.from(n.entries()).sort((e,t)=>e[1]-t[1]).reverse().slice(0,t).map(e=>({key:e[0],count:e[1]}))},eV=(e,t)=>e&&0!==e.length?t&&0!==t.length?e.map(n=>{let i=t.find(e=>e.key===n.key);if(!i){console.warn("No description found for option: ".concat(n.key),e,t);return}return{key:n.key,title:i.title,description:i.description,graphic:i.graphic,count:n.count}}).filter(e=>!!e).map(e=>e):(console.warn("No described options available"),[]):[];function eM(e){let{answers:t}=(0,v.ZP)(e.qids.qid),[n,i]=(0,p.useState)([]),[o,r]=(0,p.useState)([]);(0,p.useEffect)(()=>{i(eU(t,e.displayCount))},[t,e.displayCount]),(0,p.useEffect)(()=>{r(eV(n,e.options))},[n,e.options]);let s=(0,C.Z)();return(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[e.question&&(0,u.jsx)(Z.Z,{content:e.question}),(0,u.jsx)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"row",alignItems:"stretch",justifyContent:"stretch",gap:1},children:o.map((t,n)=>(0,u.jsxs)(w.Z,{sx:{flexGrow:1,flexBasis:0,p:2,borderRadius:2,background:s.palette.summaryChartBackground.main,display:"flex",flexDirection:"column",gap:1,mt:2*n},children:[(0,u.jsx)(I.Z,{variant:"topOptionsOptionRank",align:"left",children:(0,eB.q)(n+1)}),(0,u.jsxs)(I.Z,{variant:"topOptionsOptionPoints",align:"left",children:["Total points: ",t.count]}),(0,u.jsx)(w.Z,{sx:{width:"10%",height:0,border:"4px solid black",borderRadius:"4px",mt:1,mb:3}}),(0,u.jsx)(I.Z,{variant:"topOptionsOptionTitle",align:"left",children:t.title}),void 0!==t.graphic&&(0,u.jsx)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"end"},children:(0,u.jsx)(w.Z,{sx:{maxHeight:"20vh",height:"20vh",backgroundImage:"url(".concat(t.graphic,")"),backgroundSize:"cover",backgroundPosition:"center",borderRadius:2}})},"".concat(e.qids.qid,"-top-option-").concat(n,"-graphic-").concat(t.key))]},"".concat(e.qids.qid,"-top-option-").concat(n,"-description-").concat(t.key)))})]})}function eN(e){let t=(0,C.Z)();return(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,u.jsxs)(w.Z,{sx:{background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2,gap:1},children:[(0,u.jsx)("img",{src:"/icons/updown/qmark.svg",alt:"Disagree icon",style:{width:"auto",height:"2rem"}}),(0,u.jsx)(eS,{variant:"upDownCategory",children:e.divisiveDescription})]}),e.mostDivisive.map((e,n)=>(0,u.jsx)(eS,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDivided.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]}),(0,u.jsxs)(w.Z,{sx:{background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2,gap:1},children:[(0,u.jsx)("img",{src:"/icons/updown/check.svg",alt:"Disagree icon",style:{width:"auto",height:"2rem"}}),(0,u.jsx)(eS,{variant:"upDownCategory",children:e.supportedDescription})]}),e.mostlySupported.map((e,n)=>(0,u.jsx)(eS,{variant:"upDownQuestion",sx:{background:t.palette.backgroundAgree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]}),(0,u.jsxs)(w.Z,{sx:{background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2,gap:1},children:[(0,u.jsx)("img",{src:"/icons/updown/cross.svg",alt:"Disagree icon",style:{width:"auto",height:"2rem"}}),(0,u.jsx)(eS,{variant:"upDownCategory",children:e.opposedDescription})]}),e.mostlyOpposed.map((e,n)=>(0,u.jsx)(eS,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDisagree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})]})}function eO(e){let t=(0,C.Z)();return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:(0,u.jsxs)(D.ZP,{container:!0,flexGrow:1,children:[(0,u.jsx)(D.ZP,{item:!0,xs:12,sx:{pb:1},children:(0,u.jsxs)(w.Z,{sx:{height:"100%",width:"100%",background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch",overflowX:"hidden",overflowY:"auto"},children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2,gap:1},children:[(0,u.jsx)("img",{src:"/icons/updown/qmark.svg",alt:"Disagree icon",style:{width:"auto",height:"2rem"}}),(0,u.jsx)(eS,{variant:"upDownCategory",children:e.divisiveDescription})]}),e.mostDivisive.map((e,n)=>(0,u.jsx)(eS,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDivided.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})}),(0,u.jsx)(D.ZP,{item:!0,xs:6,sx:{pr:1},children:(0,u.jsxs)(w.Z,{sx:{height:"100%",width:"100%",background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch",overflowX:"hidden",overflowY:"auto"},children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2,gap:1},children:[(0,u.jsx)("img",{src:"/icons/updown/check.svg",alt:"Disagree icon",style:{width:"auto",height:"2rem"}}),(0,u.jsx)(eS,{variant:"upDownCategory",children:e.supportedDescription})]}),e.mostlySupported.map((e,n)=>(0,u.jsx)(eS,{variant:"upDownQuestion",sx:{background:t.palette.backgroundAgree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})}),(0,u.jsx)(D.ZP,{item:!0,xs:6,sx:{p:0},children:(0,u.jsxs)(w.Z,{sx:{height:"100%",width:"100%",background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch",overflowX:"hidden",overflowY:"auto"},children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2,gap:1},children:[(0,u.jsx)("img",{src:"/icons/updown/cross.svg",alt:"Disagree icon",style:{width:"auto",height:"2rem"}}),(0,u.jsx)(eS,{variant:"upDownCategory",children:e.opposedDescription})]}),e.mostlyOpposed.map((e,n)=>(0,u.jsx)(eS,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDisagree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})})]})})})}function eW(e){let{allAnswers:t}=(0,v.ZP)(),[n,i]=(0,p.useState)([]),[o,r]=(0,p.useState)([]),[s,a]=(0,p.useState)([]),[c,d]=(0,p.useState)([]);return(0,p.useEffect)(()=>{let n=[],o=[],s=[],c=[];Object.entries(t).forEach(t=>{let[i,r]=t;if(void 0!==Object.keys(e.questions).find(e=>e===i)){let t=r.filter(e=>{var t,n;return(null===(n=e.jsonValue)||void 0===n?void 0:null===(t=n.answers[0])||void 0===t?void 0:t.numericValue)!==void 0&&eg(e.jsonValue.answers[0].numericValue)===l.Yes}).length,a=r.filter(e=>{var t,n;return(null===(n=e.jsonValue)||void 0===n?void 0:null===(t=n.answers[0])||void 0===t?void 0:t.numericValue)!==void 0&&eg(e.jsonValue.answers[0].numericValue)===l.No}).length,d=r.filter(e=>{var t,n;return(null===(n=e.jsonValue)||void 0===n?void 0:null===(t=n.answers[0])||void 0===t?void 0:t.numericValue)!==void 0&&eg(e.jsonValue.answers[0].numericValue)===l.Unsure}).length,u=e.questions[i].assertion,h={qid:i,assertion:u,yes:t,no:a,unsure:d},p=t+a;p>0?t>=2*p/3?n=[...n,h]:a>=2*p/3?o=[...o,h]:s=[...s,h]:c=[...c,h]}}),r(n),a(o),i(s),d(c)},[t,e.questions]),(0,u.jsxs)(u.Fragment,{children:["tshape"===e.layout&&(0,u.jsx)(eO,{mostDivisive:n,mostlySupported:o,mostlyOpposed:s,unanswered:c,divisiveDescription:e.divisiveDescription,supportedDescription:e.supportedDescription,opposedDescription:e.opposedDescription,unansweredDescription:e.unansweredDescription}),"column"===e.layout&&(0,u.jsx)(eN,{mostDivisive:n,mostlySupported:o,mostlyOpposed:s,unanswered:c,divisiveDescription:e.divisiveDescription,supportedDescription:e.supportedDescription,opposedDescription:e.opposedDescription,unansweredDescription:e.unansweredDescription})]})}var eK=n(11144),eL=n(67506),ez=n(23447),eG=n(99128),eH=n(96044),eJ=n(70883),eY=n(31655);let eX=(e,t)=>{var n;return null===(n=t.find(t=>t.deviceId===e))||void 0===n?void 0:n.participantName};function eQ(e){let{subscriptions:t,thisUser:n}=(0,p.useContext)(eJ.l),{session:i}=(0,p.useContext)(eK.z),[o,r]=(0,p.useState)({}),[s,a]=(0,p.useState)({});(0,p.useEffect)(()=>{var t,n,o;r(null!==(o=JSON.parse(null!==(n=null===(t=i.liveExperienceState)||void 0===t?void 0:t.videoReadinessJson)&&void 0!==n?n:"{}")[e.videoId])&&void 0!==o?o:{})},[i]),(0,p.useEffect)(()=>{a(Object.fromEntries(t.filter(e=>e.deviceId!==(null==n?void 0:n.deviceId)).map(e=>e.deviceId).map(e=>[e,e in o?o[e]:void 0])))},[o,t]);let l=e=>void 0===e?"gray":e?"green":"red",c=e=>void 0===e?"checking":e?"ready":"not ready yet";return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(w.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"center",gap:1},children:Object.entries(s).map(n=>{var i;return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(eY.Z,{title:"".concat(null!==(i=eX(n[0],t))&&void 0!==i?i:"Unknown"," (").concat(c(n[1]),")"),children:(0,u.jsx)(w.Z,{sx:{width:"0.75rem",height:"0.75rem",borderRadius:"50%",backgroundColor:l(n[1])}})},"video-".concat(e.videoId,"-readiness-").concat(n[0]))})})})})}var e$=n(40395),e0=n(63858);let e1=(e,t,n,i,o)=>e!==y.tB.Playing&&!t&&n!==y._b.Controller&&i&&e0.G6&&o,e2=(e,t,n)=>t===y._b.Controller||e||!n||!e0.G6;function e5(e){let{api:t,start:n}=(0,p.useContext)(ez.E),[i,o]=(0,p.useState)(e2(e.playedOnce,e.role,e.audio)),r=(0,p.useRef)(i),[s,a]=(0,p.useState)(!1),[l,c]=(0,p.useState)(!1),[d,h]=(0,p.useState)(!1);(0,p.useEffect)(()=>{o(e2(e.playedOnce,e.role,e.audio))},[e.playedOnce,e.role,e.audio,e.inView]),(0,p.useEffect)(()=>{a(e1(e.playMode,i,e.role,e.audio,e.inView))},[e.playMode,i,e.role,e.audio,e.inView]),(0,p.useEffect)(()=>{e.role===y._b.Client&&e.inView&&(x(i),r.current=i)},[i,e.inView,e.role]);let x=async i=>{let o={action:"video-readiness-update",sessionId:e.sessionId,deviceId:e.deviceId,ticks:Date.now(),parameters:{videoId:e.videoId,ready:i}};try{c(!0),await n(t.postParticipantAction(e.sessionToken,o,!1))}catch(e){console.error(e),h(!0)}finally{c(!1)}},m=async e=>{try{await f()}catch(e){console.error(e),o(!1),h(!0)}};(0,p.useEffect)(()=>{e.setShowActivationFailed(d),e.setOverrideControls(d)},[d]);let f=async()=>{if(!e.playerRef.current)throw Error("Unable to activate video: Player not ready");try{await e.playerRef.current.play(),e.playerRef.current.pause()}catch(e){throw console.error(e),Error("Failed to activate video")}};return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(e$.Z,{open:e.inView&&s,setOpen:a,onSelect:m,dismissible:!1,showCloseButton:!1,title:"Ready for video?",prompt:"Please let us know when you are ready to watch the video.",options:[{key:"ready",text:"Ready",filled:!0}],busy:l})})}function e4(e){let{toServerTime:t,fromServerTime:n}=(0,p.useContext)(eL.G),{sid:i}=(0,p.useContext)(tW),{api:o,start:r}=(0,p.useContext)(ez.E),{user:s,sessionToken:a,role:l,deviceId:c}=(0,p.useContext)(j.rZ),{session:d}=(0,p.useContext)(eK.z),h=(0,p.useRef)(null),{ref:x,inView:m}=(0,eH.YD)({threshold:0}),[f,g]=(0,p.useState)(0),[v,k]=(0,p.useState)(!1),[Z,S]=(0,p.useState)(!1),[C,D]=(0,p.useState)(y.tB.NotStarted),E=(0,p.useRef)(),[A,q]=(0,p.useState)(0),[P,T]=(0,p.useState)(),[_,F]=(0,p.useState)(),R=(0,p.useRef)(0),[B,U]=(0,p.useState)(!1),[V,M]=(0,p.useState)(!1),[O,W]=(0,p.useState)(!1),[K,L]=(0,p.useState)(!1);(0,p.useEffect)(()=>{null!==h.current&&(h.current.addEventListener("play",e=>{U(!0),D(y.tB.Playing)}),h.current.addEventListener("pause",e=>{D(y.tB.Paused)}),h.current.addEventListener("ended",e=>{D(y.tB.Ended)}),document.addEventListener("visibilitychange",()=>S("visible"===document.visibilityState)),S("visible"===document.visibilityState))},[h]),(0,p.useEffect)(()=>{m?(g(1),z().then(()=>{g(2)}).catch(e=>{console.error(e),g(3)}).finally(()=>{U(!1)})):G().then(()=>{g(0)}).catch(e=>{console.error(e),g(3)}).finally(()=>{U(!1)})},[m]),(0,p.useEffect)(()=>{W(l!=y._b.Controller&&C!==y.tB.Playing)},[l,C]),(0,p.useEffect)(()=>{2===f&&m&&_&&Y(_)},[f,m,_]);let z=async()=>{if(null===h.current)throw Error("Player not ready");console.debug("Loading video"),h.current.setAttribute("src",e.videoUri),h.current.load()},G=async()=>{if(null===h.current)throw Error("Player not ready");console.debug("Unloading video"),h.current.removeAttribute("src"),h.current.load()},H=async(n,l)=>{if(null===h.current)throw Error("Player not ready");try{k(!0);let c=h.current.currentTime,d={videoId:e.videoId,modeChange:n,modeChangePosition_s:c,modeChangeServerTime_ms:t(null!=l?l:Date.now())},u={action:"set-video-sync",sessionId:i,parameters:d,ticks:Date.now()},p=await r(o.postFacilitatorAction(s.access_token,a,u,!1));console.debug("sync result",p)}catch(e){console.error("sync error",e)}finally{k(!1)}},J=e=>{switch(e){case"restart":h.current.currentTime=0,h.current.pause(),H(y.tB.Paused),$();break;case"back":h.current.currentTime-=15,h.current.pause(),H(y.tB.Paused),$();break;case"play-pause":C===y.tB.Playing?H(y.tB.Paused):H(y.tB.Playing,Date.now()+2e3);break;case"fwd":h.current.currentTime+=15,h.current.pause(),H(y.tB.Paused),$()}};(0,p.useEffect)(()=>{d.liveExperienceState.sequence>=R.current&&(R.current=d.liveExperienceState.sequence,F(d.liveExperienceState.videoSync.find(t=>t.videoId===e.videoId)))},[d.liveExperienceState]);let Y=e=>{if(null===h.current)return;if(void 0!==P&&(clearTimeout(P),T(void 0)),e.modeChange!==y.tB.Playing){Q(e);return}let t=n(e.modeChangeServerTime_ms)-Date.now();console.debug("Video sync scheduled for "+t+"ms");let i=t<0?Math.abs(t/1e3):0,o={...e,modeChangePosition_s:e.modeChangePosition_s+i},r=setTimeout(()=>{T(void 0),Q(o)},Math.max(0,t));T(r)},Q=e=>{if(null===h.current)return;console.debug("Video sync enaction: ".concat(y.tB[e.modeChange]," at ").concat(e.modeChangePosition_s,"s"));let t=Math.min(Math.round((e.modeChangePosition_s+Number.EPSILON)*1e3)/1e3,isFinite(h.current.duration)?h.current.duration:0);console.debug("newPosition",t),console.debug("duration",h.current.duration),h.current.currentTime=t,e.modeChange===y.tB.Playing&&h.current.currentTime<h.current.duration?h.current.play():h.current.pause()};(0,p.useEffect)(()=>{let t={type:X.M.Media_Playback_Update,data:{videoId:e.videoId,isPlaying:C===y.tB.Playing}};X.Z.emit(t),$(),void 0!==E.current&&(clearInterval(E.current),E.current=void 0),C===y.tB.Playing&&void 0===E.current&&(E.current=setInterval(()=>{$()},100))},[C,e.videoId]);let $=()=>{null!==h.current&&q(h.current.currentTime/h.current.duration*100)};return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(e5,{role:l,videoId:e.videoId,audio:e.audio,inView:m,docVisible:Z,state:f,playMode:C,deviceId:c,sessionId:i,playedOnce:B,playerRef:h,sessionToken:a,setOverrideControls:M,setShowActivationFailed:L}),(0,u.jsxs)(w.Z,{className:"stretch",ref:x,sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"stretch",gap:1,p:0},children:[3!==f&&(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center"},children:(0,u.jsxs)(w.Z,{sx:{position:"relative",flexGrow:1},children:[(0,u.jsxs)(w.Z,{sx:{position:"absolute",top:"100%",left:0,right:0},children:[O&&(0,u.jsx)(I.Z,{variant:"body2",color:"white",children:(0,u.jsx)(b.Z,{i18nKey:"video.videoReadiness"})}),K&&(0,u.jsx)(I.Z,{variant:"body2",color:"red",children:(0,u.jsx)(b.Z,{i18nKey:"video.videoInitFailed"})}),V&&(0,u.jsx)(I.Z,{variant:"body2",color:"red",children:(0,u.jsx)(b.Z,{i18nKey:"video.videoManualControl"})})]}),(0,u.jsx)("video",{ref:h,style:{width:"100%",height:"100%",borderRadius:"0.5rem",overflow:"hidden",objectFit:"contain",backgroundColor:"rgba(0,0,0,0.5)"},poster:e.posterUri,preload:"auto",loop:!1,autoPlay:!1,controls:V,disablePictureInPicture:!0,muted:!e.audio,crossOrigin:"anonymous",className:"shadow",playsInline:!0,"webkit-playsinline":"true"}),e.controls&&null!==h.current&&(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(w.Z,{sx:{position:"absolute",left:"50%",bottom:0},children:(0,u.jsxs)(w.Z,{sx:{position:"relative",left:"-50%",bottom:0,p:1,background:"rgba(255,255,255,0.75)",borderRadius:"0.5rem",alignSelf:"center",display:"flex",flexDirection:"column",gap:1},children:[(0,u.jsx)(eG.Z,{variant:1===f?"indeterminate":"determinate",value:A,color:1===f?"primary":"error"}),(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignSelf:"stretch",justifyContent:"center",gap:1},children:[(0,u.jsx)(N.Z,{variant:"outlined",disabled:2!==f||v,btnKey:"restart",btnText:"Restart",onClick:J}),(0,u.jsx)(N.Z,{variant:"outlined",disabled:2!==f||v,btnKey:"back",btnText:"-15s",onClick:J}),(0,u.jsx)(N.Z,{disabled:2!==f||v,btnKey:"play-pause",variant:C===y.tB.Playing?"outlined":"contained",busy:void 0!==P,btnText:C===y.tB.Playing?"Pause":"Play",onClick:J}),(0,u.jsx)(N.Z,{variant:"outlined",disabled:2!==f||v,btnKey:"fwd",btnText:"+15s",onClick:J})]}),(0,u.jsx)(eQ,{videoId:e.videoId})]})})})]})})}),3===f&&(0,u.jsx)("p",{children:(0,u.jsx)(b.Z,{i18nKey:"video.videoInitFailed"})})]})]})}function e3(e){let{session:t}=(0,p.useContext)(eK.z);return t.remoteConfiguration===e.config?e.children:null}(r=c||(c={}))[r.Unloaded=0]="Unloaded",r[r.Loading=1]="Loading",r[r.Ready=2]="Ready",r[r.Error=3]="Error";var e6=n(30089);let e8=e=>({replace:(t,n)=>e7(t,e)}),e7=(e,t)=>{if(e instanceof h.W_&&e.attribs){var n;let i;switch(e.tagName.toLowerCase()){case"sidebarlayout":i=tD(e,t);break;case"fullpagescrollinglayout":i=tI(e,t);break;case"fullpagecentredlayout":i=tE(e,t);break;case"columnlayout":i=tA(e,t);break;case"slidebackgroundimage":i=tq(e,t);break;case"imageslide":i=tZ(e,t);break;case"videoslide":i=to(e,t);break;case"summaryslidelayout":i=tr(e,t);break;case"sectionheading":i=tT(e,t);break;case"slidetext":i=t_(e,t);break;case"slideimage":case"img":i=tF(e,t);break;case"inputorcompletion":i=tS(e,t);break;case"inputsequence":i=tC(e,t);break;case"sliderinput":i=ts(e,t);break;case"textinput":i=td(e,t);break;case"demographicinput":i=tx(e,t);break;case"updownvoteinput":i=tm(e,t);break;case"closedchoiceinput":i=tf(e,t);break;case"pointsallocationinput":i=tg(e,t);break;case"multisliderinput":i=ty(e,t);break;case"acknowledgementinput":i=tb(e,t);break;case"rankedlistinput":i=tv(e,t);break;case"consentinput":i=tj(e,t);break;case"completion":i=tP(e,t);break;case"speechbubbles":i=tc(e,t);break;case"selectiongraph":i=ta(e,t);break;case"updownvoteresults":i=tl(e,t);break;case"topoptions":i=tw(e,t);break;case"orderedlist":i=tk(e,t);break;case"remoteconfiguration":i=ti(e,t);break;default:return e}return null!==(n=(0,e6.te)(i,t.keyPrefix))&&void 0!==n?n:i}},e9=(e,t)=>{let n=e.children.map((e,n)=>e8(t).replace(e,n)).filter(e=>null!=e&&!1!==e).map(e=>e instanceof h.W_?(0,h.du)([e],e8(t)):e);return p.Children.toArray(n)},te=(e,t)=>{let n=[];for(let i of e.children.filter(e=>e instanceof h.W_).map(e=>e))void 0!==i.attribs.qid?n.push(tt(t,i)):n=[...n,...te(i,t)];return n},tt=(e,t)=>{let n=t.attribs.qid;if(void 0===n)throw console.error("Question id not found for element",t),"Question id not found for element";return{sid:e.sessionId,pid:e.deviceId,qid:n}},tn=e=>{var t,n;let i=e.attribs.instruction,o=null!==(n=null!==(t=e.attribs.question)&&void 0!==t?t:e.attribs.statement)&&void 0!==n?n:e.attribs.prompt,r=e.attribs.explanation,s=(0,g.gx)(e.attribs.pii);return i||o||r||void 0!==s?{instruction:i,question:o,explanation:r,pii:s}:void 0},ti=(e,t)=>{let n=Number(e.attribs.config),i=e9(e,t);return(0,u.jsx)(e3,{config:n,children:i})},to=(e,t)=>{console.debug("Enriching VideoSlide tag as VideoSlide...",e);let n=e.attribs.id,i=e.attribs.videouri,o=e.attribs.posteruri,r=t.role===y._b.Controller,s=t.role===y._b.Controller||t.remoteMedia;return(0,u.jsx)(e4,{videoId:n,controls:r,audio:s,videoUri:i,posterUri:o})},tr=(e,t)=>{console.debug("Enriching SummarySlideLayout tag as SummarySlideLayout...",e);let n=e.attribs.title,i=e.attribs.prompt,o=void 0!==e.attribs.chartbackground?(0,g.gx)(e.attribs.chartbackground):void 0,r=e9(e,t);return(0,u.jsx)(eC,{title:n,prompt:i,chartBackground:o,children:r})},ts=(e,t)=>{var n;console.debug("Enriching SliderInput tag as SliderInput...",e);let i=tt(t,e),o=tn(e),r=(0,e6.av)(e.attribs.type),s=r===eh.Q.categorical?(0,e6.kh)(e.attribs.marks):void 0,a=r!==eh.Q.categorical?null===(n=(0,e6.kh)(e.attribs.range))||void 0===n?void 0:n.map(e=>(0,e6.f_)(e.trim())):void 0,l=r!==eh.Q.categorical?(0,e6.f_)(e.attribs.step):void 0,c=(0,g.gx)(e.attribs.showunsure);return(0,u.jsx)(eh.Z,{qids:i,role:t.role,type:r,marks:s,numericRange:a,numericStep:l,question:o,showUnsure:c,onAnswer:t.onAnswer})},ta=(e,t)=>{var n;console.debug("Enriching SelectionGraph tag as AnswerGraphMuiChart...",e);let i=tt(t,e),o=tn(e),r=(0,e6.yg)(e.attribs.orientation),s=(0,e6.ot)(e.attribs.type),a=null===(n=(0,e6.kh)(e.attribs.range))||void 0===n?void 0:n.map(e=>m().toNumber(e.trim())),l=(0,e6.tL)((0,e6.kh)(e.attribs.categories));if(i&&void 0!==s)return(0,u.jsx)(eE.Z,{role:t.role,qids:i,question:o,inputType:s,orientation:r,categories:l,range:a?{lo:a[0],hi:a[1],step:a[2]}:void 0});throw console.error("SelectionGraph without qIds, type, or range",e.attribs),"SelectionGraph without qIds, type, or range"},tl=(e,t)=>{console.debug("Enriching UpDownVoteResults tag as UpDownVoteResults...",e);let n=e.attribs.layout,i=e.attribs.divisivedescription,o=e.attribs.supporteddescription,r=e.attribs.opposeddescription,s=e.attribs.unanswereddescription,a={};for(let t of e.children)if(t instanceof h.W_&&"result"===t.tagName){let e=t.attribs.qid,n=t.attribs.assertion;void 0!==e&&(a[e]={assertion:n})}return(0,u.jsx)(eW,{questions:a,layout:n,divisiveDescription:null!=i?i:(0,u.jsx)(b.Z,{i18nKey:"upDownResult.divisiveDescription"}),supportedDescription:null!=o?o:(0,u.jsx)(b.Z,{i18nKey:"upDownResult.supportedDescription"}),opposedDescription:null!=r?r:(0,u.jsx)(b.Z,{i18nKey:"upDownResult.opposedDescription"}),unansweredDescription:null!=s?s:(0,u.jsx)(b.Z,{i18nKey:"upDownResult.unansweredDescription"})})},tc=(e,t)=>{console.debug("Enriching SpeechBubbles tag as SpeechBubbles (with children)...",e);let n=tt(t,e),i=tn(e);return(0,u.jsx)(eR,{qids:n,question:i})},td=(e,t)=>{var n;let i;console.debug("Enriching TextInput tag as TextInput...",e);let o=tt(t,e),r=tn(e),s=(0,e6.H7)(e.attribs.type),a=e.attribs.label,l=e.attribs.help,c=e.attribs.submittext,d=e.attribs.skiptext,p=m().parseInt(e.attribs.mincheckboxes),x=(0,g.gx)(null!==(n=e.attribs.textrequired)&&void 0!==n?n:"true"),f=[];for(let t of e.childNodes)if(t instanceof h.W_&&"information"===t.tagName&&(i={heading:t.attribs.heading,body:t.children}),t instanceof h.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.text,i=(0,g.gx)(t.attribs.required);f.push({key:e,text:n,initial:!1,required:i,checked:!1})}if(void 0===r||void 0===r.pii)throw"pii not defined for TextInput";return(0,u.jsx)(ep.Z,{qids:o,role:t.role,type:s,label:a,help:l,textRequired:x,minCheckboxes:p,information:i,onAnswer:t.onAnswer,checkboxes:f,question:r,submitText:c,skipText:d})},tu=e=>{let t=[];for(let n of e)if(n instanceof h.W_&&"demographicinputtype"===n.tagName){let e=n.attribs.key,i=n.attribs.label,o=n.attribs.layout,r=n.attribs.mode,s=n.attribs.textplaceholder,a=n.attribs.textvalidationregex,l=(0,g.LC)(n.attribs.columns);if(e&&i&&r){let c=th(n.children);t.push({key:e,label:i,layout:o,layoutProps:void 0!==l?{columns:l}:void 0,groups:c,mode:r,textPlaceholder:s,textValidationRegex:a})}else throw console.warn("DemographicInputType without key, label, layout, or mode",n),"DemographicInput child without key, label, layout, or mode"}return t},th=e=>{let t=[];for(let n of e)if(n instanceof h.W_&&"demographicgroup"===n.tagName){let e=n.attribs.label;if(e){let i=tp(n.children);t.push({label:e,choices:i})}else throw console.warn("DemographicGroup without label",n),"DemographicGroup without label"}return t},tp=e=>{let t=[];for(let n of e)if(n instanceof h.W_&&"demographic"===n.tagName){let e=n.attribs.display,i=n.attribs.value;if(e&&i)t.push({display:e,key:i});else throw console.warn("Demographic without display or value",n),"Demographic without display or value"}return t},tx=(e,t)=>{console.debug("Enriching DemographicInput tag as DemographicInput...",e);let n=tt(t,e),i=tn(e),o=(0,g.gx)(e.attribs.showage),r=(0,g.gx)(e.attribs.showgender),s=(0,g.gx)(e.attribs.showethnicity),a=e.attribs.showpostcode,l=tu(e.children);return(0,u.jsx)(Y,{role:t.role,qids:n,onAnswer:t.onAnswer,question:i,showAge:o,showGender:r,showEthnicity:s,showPostcode:a,customDemographics:l})},tm=(e,t)=>{console.debug("Enriching UpDownVoteInput tag as UpDownVoteInput...",e);let n=tt(t,e),i=tn(e),o=e.attribs.assertion;return(0,u.jsx)(ey,{qids:n,role:t.role,question:i,assertion:o,onAnswer:t.onAnswer})},tf=(e,t)=>{console.debug("Enriching ClosedChoiceInput tag as ClosedChoiceInput...",e);let n=tt(t,e),i=tn(e),o=parseInt(e.attribs.minselections),r=parseInt(e.attribs.maxselections),s=e.attribs.layout,a=e.attribs.layoutparams,l=a?(0,e6.kh)(a):[],c=[],d=(0,g.gx)(e.attribs.shuffle);for(let t of e.children)if(t instanceof h.W_&&"option"===t.tagName){let e=t.attribs.value,n=t.attribs.display,i=t.attribs.graphic,o=(0,g.gx)(t.attribs.isalt);e&&n&&c.push({key:e,display:n,graphic:i,isAlt:o})}return(0,u.jsx)(R,{qids:n,role:t.role,question:i,options:c,shuffle:d,onAnswer:t.onAnswer,layout:s,layoutParams:l,minSelections:o,maxSelections:r,contentStore:t.contentStore})},tg=(e,t)=>{console.debug("Enriching PointsAllocationInput tag as PointsAllocationInput...",e);let n=tt(t,e),i=tn(e),o=parseInt(e.attribs.points),r=[];for(let t of e.children)if(t instanceof h.W_&&"option"===t.tagName){let e=t.attribs.title,n=t.attribs.description,i=t.attribs.key,o=parseInt(t.attribs.min),s=parseInt(t.attribs.max),a=t.attribs.graphic;if(e&&n&&i&&void 0!==o&&void 0!==s)r.push({title:e,description:n,key:i,min:o,max:s,graphic:a});else throw"PointsAllocationInput Option without title, description, key, min, or max"}return(0,u.jsx)(er,{qids:n,question:i,points:o,options:r,onAnswer:t.onAnswer})},ty=(e,t)=>{console.debug("Enriching MultiSliderInput tag as MultiSliderInput...",e);let n=tt(t,e),i=tn(e),o=parseInt(e.attribs.min),r=parseInt(e.attribs.max),s=[],a=[],l=(0,g.gx)(e.attribs.showdescriptions);for(let t of e.children)if(t instanceof h.W_&&"label"===t.tagName){let e=parseFloat(t.attribs.at),n=t.attribs.text;void 0!==e&&n&&s.push({at:e,text:n})}else if(t instanceof h.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description;e&&n&&a.push({key:e,title:n,description:i})}return(0,u.jsx)(ei,{qids:n,question:i,min:o,max:r,labels:s,options:a,showDescriptions:l,role:t.role,onAnswer:t.onAnswer})},tb=(e,t)=>{console.debug("Enriching AcknowledgementInput tag as AcknowledgementInput...",e);let n=tt(t,e),i=tn(e),o=e.attribs.align,r=[];for(let t of e.children)if(t instanceof h.W_&&"option"===t.tagName){let e=t.attribs.text,n=t.attribs.key,i=t.attribs.variant,o=t.attribs.colour;e&&n&&r.push({text:e,key:n,variant:i,colour:o})}return(0,u.jsx)(S,{qids:n,question:i,options:r,align:o,onAnswer:t.onAnswer})},tv=(e,t)=>{console.debug("Enriching RankedListInput tag as RankedListInput...",e);let n=tt(t,e),i=tn(e),o=[],r=(0,g.gx)(e.attribs.shuffle),s=0;for(let t of e.children)if(t instanceof h.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description;n&&o.push({key:e,title:n,description:i,startingIndex:s++})}return(0,u.jsx)(eu,{qids:n,question:i,options:o,shuffle:r,onAnswer:t.onAnswer})},tj=(e,t)=>{console.debug("Enriching ConsentInput tag as ConsentInput...",e);let n=tt(t,e),i=tn(e),o=e.attribs.consenttext;return(0,u.jsx)(O,{qids:n,question:i,consentText:o,onAnswer:t.onAnswer,content:e.children})},tw=(e,t)=>{console.debug("Enriching TopOptions tag as TopOptionsSummary...",e);let n=tt(t,e),i=tn(e),o=parseInt(e.attribs.count),r=[];for(let t of e.children)if(t instanceof h.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description,o=t.attribs.graphic;e&&n&&i&&r.push({key:e,title:n,description:i,graphic:o})}return(0,u.jsx)(eM,{qids:n,question:i,options:r,displayCount:o})},tk=(e,t)=>{console.debug("Enriching OrderedList tag as OrderedListDisplay...",e);let n=tt(t,e),i=tn(e),o=e.attribs.startcolour,r=e.attribs.endcolour,s=e.attribs.mode,a=[];for(let t of e.children)if(t instanceof h.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description;if(e&&n)a.push({key:e,title:n,description:i});else throw console.warn("OrderedList option without key or title",t),"OrderedList option without key or title"}return(0,u.jsx)(e_,{qids:n,question:i,options:a,role:t.role,startColour:o,endColour:r,mode:s})},tZ=(e,t)=>{console.debug("Enriching ImageSlide tag as ImageSlide...",e);let n=e.attribs.src,i=(0,e6.Cc)(e.attribs.style);return(0,u.jsx)(ew,{style:i,src:n})},tS=(e,t)=>{let n=e9(e,t);console.debug("Enriching InputOrCompletion tag as InputOrCompletion (with children)...",n);let i=tt(t,e);return(0,u.jsx)(Q,{qids:i,input:n[0],completion:n[1]})},tC=(e,t)=>{let n=e9(e,t);console.debug("Enriching InputSequence tag as InputSequence (with children)...",n);let i=[];for(let e=0;e<n.length-1;e++)i.push(n[e]);let o=n[n.length-1],r=tn(e),s=(0,g.gx)(e.attribs.showprogress),a=te(e,t);return(0,u.jsx)(et,{question:r,showProgress:s,qids:a,inputs:i,completion:o,role:t.role})},tD=(e,t)=>{console.debug("Enriching SideBarLayout tag as SideBarLayout (with children)...",e);let n=e9(e,t),i=(0,e6.if)(e.attribs.sidestyle),o=(0,e6.if)(e.attribs.mainstyle),r=e.attribs.sidebackgroundimage,s=e.attribs.mainbackgroundimage;return(0,u.jsx)(ek,{side:n[0],sideSx:i,main:n[1],mainSx:o,sideBackgroundImage:r,mainBackgroundImage:s,contentStore:t.contentStore})},tI=(e,t)=>{console.debug("Enriching FullPageScrollingLayout tag as FullPageScrollingLayout (with children)...",e);let n=(0,e6.if)(e.attribs.sx),i=e9(e,t);return(0,u.jsx)(ej,{sx:n,children:i})},tE=(e,t)=>{console.debug("Enriching FullPageCentredLayout tag as FullPageCentredLayout (with children)...",e);let n=(0,e6.if)(e.attribs.sx),i=e9(e,t);return(0,u.jsx)(ev,{sx:n,children:i})},tA=(e,t)=>{console.debug("Enriching ColumnLayout tag as ColumnLayout (with children)...",e);let n=(0,e6.if)(e.attribs.sx),i=e9(e,t);return(0,u.jsx)(eb,{sx:n,children:i})},tq=(e,t)=>{console.debug("Enriching SlideBackgroundImage tag as SlideBackgroundImage (with children)...",e);let n=e9(e,t),i=e.attribs.src,o=(0,e6.if)(e.attribs.sx);return(0,u.jsx)(eZ,{src:i,sx:o,children:n})},tP=(e,t)=>{console.debug("Enriching Completion tag as CompletionDisplay (with children)...",e);let n=e.attribs.message,i=e.attribs.factoid,o=(0,e6.if)(e.attribs.sx);return(0,u.jsx)(eI,{content:{message:n,factoid:i},sx:o})},tT=(e,t)=>{console.debug("Enriching SectionHeading tag as SectionHeading...",e);let n=(0,f.Z)(),i=tn(e),o=[];for(let t of e.children)if(t instanceof h.W_&&"heading"===t.tagName){let e=t.attribs.title,n=t.attribs.description,i=t.attribs.graphic,r=(0,g.gx)(t.attribs.expanded);if(e)o.push({title:e,description:n,graphic:i,expanded:r});else throw console.warn("SectionHeading without title",t),"SectionHeading without title"}return(0,u.jsx)(eF,{question:i,headings:o,uid:n})},t_=(e,t)=>{console.debug("Enriching SlideText tag as SlideText (with children)...",e);let n=e9(e,t),i=(0,e6.if)(e.attribs.sx),o=e.attribs.color,r=e.attribs.align,s=e.attribs.variant;return(0,u.jsx)(eS,{variant:s,sx:i,color:o,align:r,children:n})},tF=(e,t)=>{console.debug("Enriching ImageSlide tag as ImageSlide...",e);let n=e.attribs.src,i=(0,e6.Cc)(e.attribs.style);return(0,u.jsx)(eD,{src:n,style:i})},tR=["src","graphic","videoUri","posterUri","sideBackgroundImage","mainBackgroundImage","data-background-image"],tB=["style","sideStyle","mainStyle"];class tU{getAsSectionTags(e,t){let n=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("section"),i=[];console.debug("Module ".concat(t," contains ").concat(n.length," sections."));for(let e=0;e<n.length;e++){let o=n.item(e);o&&o.setAttribute("key","module-".concat(t,"-section-").concat(e));let r=new XMLSerializer().serializeToString(o);i.push(r)}return m().join(i,"\n")}reset(){this.progressData={overall:{completed:0,total:0},bars:{}},this.sendUpdate()}updateProgress(e,t,n){this.progressData.bars[e]={completed:t,total:n},this.progressData.overall.completed=m().sum(Object.entries(this.progressData.bars).map(e=>e[1].completed)),this.progressData.overall.total=m().sum(Object.entries(this.progressData.bars).map(e=>e[1].total)),this.sendUpdate()}sendUpdate(){var e;null===(e=this.onUpdate)||void 0===e||e.call(this,{overall:this.progressData.overall,bars:{}})}findAllReplacements(e,t){void 0===e&&(e=this.dom.documentElement),t=this.appendNodeReplacements(e,t);for(let n=0;n<e.childNodes.length;n++)t=this.findAllReplacements(e.childNodes[n],t);return t}appendNodeReplacements(e,t){let n=[...t];if(e.nodeType===Node.ELEMENT_NODE){for(let t of tR)if(e.hasAttribute(t)){let i=e.getAttribute(t);if(void 0===n.find(e=>e.key===i)){let e=async()=>{try{return await this.zcs.getAsUrl(i,(e,t,n)=>{this.updateProgress(e,t,n)})}catch(e){throw console.error("Error fetching ".concat(t,": ").concat(i),e),e}},o={key:i,getUrlPromise:e,targets:[],attempts:0};n.push(o)}n.find(e=>e.key===i).targets.push({element:e,attribute:t})}for(let t of tB)if(e.hasAttribute(t)){let i=e.getAttribute(t);if(i.includes("url(")){let o=i.match(/url\(([^)]+)\)/)[1];if(o=m().trim(o,"\"' ()"),void 0===n.find(e=>e.key===o)){let e=async()=>{try{return await this.zcs.getAsUrl(o,(e,t,n)=>{this.updateProgress(e,t,n)})}catch(e){throw console.error("Error fetching ".concat(t,": ").concat(o),e),e}},i={key:o,getUrlPromise:e,targets:[],attempts:0};n.push(i)}n.find(e=>e.key===o).targets.push({element:e,attribute:t})}}}return n}async replaceAllReplacements(e){do{let t=e.filter(e=>this.shouldTryAgain(e)),n=await Promise.all(t.map(e=>this.replace(e)));if(n.some(e=>!e.succeeded)){let e=n.filter(e=>!1===e.succeeded);console.warn("".concat(e.length," failed replacements"),e),await new Promise(e=>setTimeout(e,1e3))}}while(e.some(e=>this.shouldTryAgain(e)));if(e.some(e=>!1===e.succeeded)){let t=e.filter(e=>!1===e.succeeded);console.error("".concat(t.length," replacements failed"),t)}return new XMLSerializer().serializeToString(this.dom)}async replace(e){try{e.attempts++;let t=await e.getUrlPromise();for(let n of e.targets){let i=n.element.getAttribute(n.attribute),o=null==i?void 0:i.replace(e.key,t);n.element.setAttribute(n.attribute,o)}e.succeeded=!0}catch(t){console.warn("Error fetching ".concat(e.key),t),e.succeeded=!1,e.error=t}finally{return e}}shouldTryAgain(e){return!0!==e.succeeded&&e.attempts<3}constructor(e,t,n){this.source=e,this.zcs=t,this.onUpdate=n,this.progressData={overall:{completed:0,total:0},bars:{}},this.dom=new DOMParser().parseFromString(e,"text/xml"),this.reset()}}class tV{async init(){if(this.initialised)return;this.storageAvailable=void 0!==window&&void 0!==window.navigator&&void 0!==window.navigator.storage,this.persistAvailable=this.storageAvailable&&void 0!==window.navigator.storage.persist,this.mayPersist=this.storageAvailable&&void 0!==window.navigator.storage.persist&&await window.navigator.storage.persist(),this.retrieveAvailable=this.storageAvailable&&void 0!==window.navigator.storage.getDirectory,this.estimateAvailable=this.storageAvailable&&void 0!==window.navigator.storage.estimate;let e={"Workshop dir":this.workshopDir,"Storage Available":this.storageAvailable,"Persist Available":this.persistAvailable,"Retrieve available":this.retrieveAvailable,"Estimate available":this.estimateAvailable,"May Persist":this.mayPersist};if(this.estimateAvailable){let t=await navigator.storage.estimate();e.Quota=t.quota,e.Usage=t.usage}else e.Quota="N/K",e.Usage="N/K";console.table(e),this.initialised=!0}async getAsUrl(e,t){if(!this.initialised)throw"Not initialised";if(e.startsWith("blob:"))return console.debug("getAsUrl","blob: url requested - passing back the same url."),e;let n=await this.getAsEntry(e,t);try{return URL.createObjectURL(n.content)}catch(t){return console.warn("getAsUrl","Unable to create blob URL for: ".concat(e),t),n.sourceUrl}}async getAsEntry(e,t){if(!this.initialised)throw"Not initialised";if(e.startsWith("blob:")){let n=e.substring(5);return await this.getAsEntry(n,t)}let n=this.forceFetch?null:await this.getCacheData(e);if(this.forceFetch&&console.debug("getAsEntry","cache skip for: ".concat(e)),null!==n&&(void 0===n.content||0===n.content.size)&&(n=null),console.debug("getAsEntry","Cache ".concat(null===n?"miss for":"hit for",": ").concat(e)),null===n){try{n=await this.fetchContent({key:e},t)}catch(t){throw console.error("getAsEntry","Unable to fetch data for: ".concat(e),t),t}try{void 0!==n.content&&n.content.size>0?(console.debug("getAsEntry","Cacheing ".concat(n.content.size," bytes of data for: ").concat(e),n),await this.storeCacheData(n)):(void 0===n.content&&console.warn("getAsEntry","Content for ".concat(e," is undefined.")),void 0!==n.content&&0===n.content.size&&console.warn("getAsEntry","Content for ".concat(e," has 0 bytes.")))}catch(t){console.warn("getAsEntry","Unable to cache the data for: ".concat(e),t)}}return n}async storeCacheData(e){if(this.persistAvailable){var t;let n=e.key.split("/").slice(-1)[0],i=new Date;e.created=null!==(t=e.created)&&void 0!==t?t:i,e.updated=i;let o=await window.navigator.storage.getDirectory(),r=await o.getDirectoryHandle("workshops",{create:!0}),s=await r.getDirectoryHandle(this.workshopDir,{create:!0}),a=await s.getDirectoryHandle("content",{create:!0}),l=await a.getFileHandle(n,{create:!0}),c=await l.createWritable();try{await c.write(e.content)}catch(e){throw console.warn("storeCacheData","error writing to cache",e),e}finally{await c.close(),console.debug("storeCacheData","content stored",e.key)}}}async getCacheData(e){if(!this.retrieveAvailable)return null;try{let t=e.split("/").slice(-1)[0],n=await window.navigator.storage.getDirectory(),i=await n.getDirectoryHandle("workshops",{create:!0}),o=await i.getDirectoryHandle(this.workshopDir,{create:!0}),r=await o.getDirectoryHandle("content",{create:!0}),s=await r.getFileHandle(t),a=await s.getFile();return{key:e,content:a}}catch(e){return console.warn("getCacheData - error encountered, this is a cache miss",e),null}}async fetchContent(e,t){return(await this.fetchContents([e],t))[0]}async fetchContents(e,t){let n=await this.getAccessUrls(e.map(e=>this.fixKeyForS3(e.key))),i=e.map(e=>({key:e.key,url:n.objectKeysToAccessUrls[this.fixKeyForS3(e.key)]}));console.debug("fetchContents","Fetched keysToUrls",i);let o=i.map(e=>this.download(e,t));console.debug("fetchContents","Fetching ".concat(o.length," content items..."));let r=await Promise.all(o);return console.debug("fetchContents","fetch contents complete",r),r}async download(e,t){let n=0;do{try{var i;let n=await fetch(e.url);if(null===n.body)throw"No content found in response for: ".concat(e.key,", at: ").concat(e.url);let o=n.headers.get("Content-Length");if(null===o)throw"Content-Length not found in response for: ".concat(e.key,", at: ").concat(e.url);let r=null!==(i=n.headers.get("Content-Type"))&&void 0!==i?i:void 0;if(void 0===r)throw"Content-Type not found in response for: ".concat(e.key,", at: ").concat(e.url);console.debug("download","".concat(e.key," content-type: ").concat(r));let s=n.body.getReader(),a=Number.parseInt(o);void 0!==t&&t(e.key,0,a);let l=[],c=0;for(;;){let{done:n,value:i}=await s.read();if(n)break;l.push(i),c+=i.length,void 0!==t&&t(e.key,c,a)}let d=new Uint8Array(c),u=0;for(let e of l)d.set(e,u),u+=e.length;return{content:new Blob(l,{type:r}),sourceUrl:e.url,key:e.key}}catch(t){console.warn("download","Error fetching: ".concat(e.key,", attempt: ").concat(n),t),await new Promise(e=>setTimeout(e,1e3))}n++}while(n<3);throw"Failed to fetch: ".concat(e.key)}async getAccessUrls(e){let t={objectKeys:e.filter(e=>this.isKeyForS3(e))},n=e.filter(e=>!this.isKeyForS3(e));console.debug("getAccessUrls","requests to s3 for:",t);let i=await this.start(this.api.postWorkshopContentAccessRequest(this.session.id,this.sessionToken,t));return n.forEach(e=>i.objectKeysToAccessUrls[e]=e),i}fixKeyForS3(e){if(this.isKeyForS3(e)){e=m().trim(e,"/");let t="workshops/".concat(this.workshopDir,"/");e.startsWith(t)||(e="".concat(t).concat(e))}return e}isKeyForS3(e){return!e.startsWith("https://")&&!e.startsWith("http://")}constructor(e,t,n,i,o,r){this.api=e,this.start=t,this.session=n,this.sessionToken=i;let s=o.split("/").slice(-2)[0];this.workshopDir=s,this.forceFetch=r,this.initialised=!1,this.storageAvailable=!1,this.persistAvailable=!1,this.mayPersist=!1,this.retrieveAvailable=!1,this.estimateAvailable=!1}}(s=d||(d={}))[s.Init=0]="Init",s[s.RetrievingRawSlides=1]="RetrievingRawSlides",s[s.RawSlidesError=2]="RawSlidesError",s[s.EnrichingSlides=3]="EnrichingSlides",s[s.EnrichmentError=4]="EnrichmentError",s[s.InflatingSlides=5]="InflatingSlides",s[s.InflationError=6]="InflationError",s[s.Ready=7]="Ready";let tM=[0,1],tN=[2,4,6],tO=[3,5],tW=(0,p.createContext)({});function tK(e){let{api:t,start:n}=(0,p.useContext)(ez.E),{session:i}=(0,p.useContext)(eK.z),o=(0,p.useContext)(j.rZ),[r,s]=(0,p.useState)(0),[a,l]=(0,p.useState)([]),[c,x]=(0,p.useState)([]),[m,f]=(0,p.useState)(void 0),[g,b]=(0,p.useState)(!0),[v,w]=(0,p.useState)(!1),[k,Z]=(0,p.useState)(!1);(0,p.useEffect)(()=>{switch(console.debug("Static content state",d[r]),r){case 0:s(1);break;case 1:S().then(e=>{l(e),s(3)}).catch(e=>{console.error(e),s(2)});break;case 3:D().then(e=>{x(e),s(5)}).catch(e=>{console.error(e),s(4)});break;case 5:I().then(e=>{f(e),s(7)}).catch(e=>{console.error(e),s(6)})}b(void 0!==tM.find(e=>e===r)),w(void 0!==tO.find(e=>e===r)),Z(void 0!==tN.find(e=>e===r))},[r]);let S=async()=>{let e=[];for(let r of i.sessionPresentationUris||[]){if(!r)throw"Presentation link empty in session data.";let s=new tV(t,n,i,o.sessionToken,r,!0);await s.init();let a=r.split("/").pop(),l=await s.getAsEntry(a,void 0),c=await l.content.text();if(!c)throw"No content found in presentation file.";e.push(c)}return e},C=e=>{X.Z.emit({type:X.M.Content_Progress_Update,data:e})},D=async()=>{let r=[];for(let s=0;s<a.length;s++){let l=i.sessionPresentationUris[s],c=a[s];if(!l)throw"Presentation link empty in session data.";let d=new tV(t,n,i,o.sessionToken,l,e.refresh);await d.init();let u=new tU(c,d,C),h=u.findAllReplacements(void 0,[]);console.debug("".concat(h.length," unique resources to replace"),h);let p=await u.replaceAllReplacements(h),x=u.getAsSectionTags(p,s);if(!x)throw"No sections found in presentation.";r.push(x)}return r},I=async()=>{let r=[];for(let s=0;s<c.length;s++){let a=i.sessionPresentationUris[s],l=c[s];if(!a)throw"Presentation link empty in session data.";if(!l)throw"No content found in presentation xml.";let d=new tV(t,n,i,o.sessionToken,a,e.refresh);await d.init();let u={sessionId:i.id,deviceId:o.deviceId,role:o.role,remoteMedia:i.remoteConfiguration!==y.VS.InPerson,remoteCall:i.remoteConfiguration===y.VS.RemoteWithVideoCall,keyPrefix:"module-".concat(s),contentStore:d,onAnswer:E},p=(0,h.ZP)(l,e8(u)),x=(p instanceof Array?p:[p]).map((e,t)=>(0,e6.te)(e,"module-".concat(s))).filter(e=>void 0!==e);r.push(...x)}return r},E=async i=>await n(t.postDeliberationAnswer(e.sid,i,o.sessionToken));return(0,u.jsxs)(u.Fragment,{children:[g&&e.init,v&&e.load,k&&e.err,7===r&&(0,u.jsx)(tW.Provider,{value:{sid:e.sid,presentationXml:c,sourceXml:a,slides:m},children:e.children})]})}},64363:function(e,t,n){n.d(t,{Z:function(){return m}});var i=n(57437),o=n(44228),r=n(42748),s=n(11656),a=n(47905),l=n(86917),c=n(14595),d=n(31193),u=n(60335),h=n(21395),p=n(24072),x=n(76396);function m(e){let t=t=>{e.onVideoPreferenceChange(e.videoEnabled,t)},n=t=>{e.onAudioPreferenceChange(e.audioEnabled,t)},m=()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(s.Z,{children:(0,i.jsx)(a.Z,{inset:!0,children:(0,i.jsx)("b",{children:"Video camera inputs"})})},"video-heading"),e.videoDevices.map(n=>{var r;let c=(null===(r=e.videoDevice)||void 0===r?void 0:r.deviceId)===(null==n?void 0:n.deviceId);return(0,i.jsxs)(s.Z,{onClick:()=>t(n),children:[c&&(0,i.jsx)(l.Z,{children:(0,i.jsx)(o.Z,{})}),(0,i.jsx)(a.Z,{inset:!c,children:n.label})]},"menu-item-select-".concat(n.deviceId))})]}),(0,i.jsx)(c.Z,{}),(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(s.Z,{children:(0,i.jsx)(a.Z,{inset:!0,children:(0,i.jsx)("b",{children:"Microphone inputs"})})},"audio-heading"),e.audioDevices.map(t=>{var r;let c=(null===(r=e.audioDevice)||void 0===r?void 0:r.deviceId)===(null==t?void 0:t.deviceId);return(0,i.jsxs)(s.Z,{onClick:()=>n(t),children:[c&&(0,i.jsx)(l.Z,{children:(0,i.jsx)(o.Z,{})}),(0,i.jsx)(a.Z,{inset:!c,children:t.label})]},"menu-item-select-".concat(t.deviceId))})]})]});return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(d.Z,{display:"flex",flexDirection:e.direction,justifyContent:"center",children:[(0,i.jsx)(u.Z,{disabled:e.busy,"aria-label":e.audioEnabled?"mute microphone":"enable microphone",onClick:()=>{e.onAudioPreferenceChange(!e.audioEnabled,e.audioDevice)},children:(0,i.jsx)("img",{src:e.audioEnabled?"/icons/av/mic-enabled.svg":"/icons/av/mic-disabled.svg"})}),(0,i.jsx)(u.Z,{disabled:e.busy,"aria-label":e.videoEnabled?"disable camera":"enable camera",onClick:()=>{e.onVideoPreferenceChange(!e.videoEnabled,e.videoDevice)},children:(0,i.jsx)("img",{src:e.videoEnabled?"/icons/av/cam-enabled.svg":"/icons/av/cam-disabled.svg"})}),e.showConfigMenu&&(0,i.jsx)(p.ZP,{variant:"popover",popupId:"av-menu-popup",children:t=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.Z,{disabled:e.busy,"aria-label":"settings",...(0,x.vW)(t),children:(0,i.jsx)("img",{src:"/icons/av/cog-enabled.svg"})}),(0,i.jsx)(h.Z,{...(0,x.wK)(t),children:(0,i.jsx)(m,{})})]})})]})})}},17882:function(e,t,n){n.d(t,{Z:function(){return l}});var i=n(57437),o=n(6722),r=n(8963),s=n(2265),a=n(64363);function l(e){let t=(0,o.HI)(),n=(0,o.Onx)(),l=(0,o.ULf)(),c=(0,o.m6Y)(),d=(0,o.fjl)(),[u,h]=(0,s.useState)(n.isVideoEnabled),[p,x]=(0,s.useState)(!t.muted),[m,f]=(0,s.useState)(void 0),[g,y]=(0,s.useState)(void 0),[b,v]=(0,s.useState)([]),[j,w]=(0,s.useState)([]),[k,Z]=(0,s.useState)(!1);(0,s.useEffect)(()=>{d.subscribeToMeetingStatus(e=>{if(e===o.ytK.Succeeded){var i,r;null===(i=d.audioVideo)||void 0===i||i.listVideoInputDevices().then(e=>{v(e),f(e.find(e=>e.deviceId===d.selectedVideoInputDevice))}),null===(r=d.audioVideo)||void 0===r||r.listAudioInputDevices().then(e=>{w(e),y(e.find(e=>e.deviceId===d.selectedAudioInputDevice))}),h(n.isVideoEnabled),x(!t.muted),d.subscribeToSelectedAudioInputDevice(S),d.subscribeToSelectedVideoInputDevice(C)}})},[]);let S=e=>{(0,o.Zws)(e).then(e=>{y(j.find(t=>t.deviceId===e))})},C=e=>{(0,o.Zws)(e).then(e=>{f(b.find(t=>t.deviceId===e))})};(0,s.useEffect)(()=>{h(n.isVideoEnabled)},[n.isVideoEnabled]),(0,s.useEffect)(()=>{x(!t.muted)},[t.muted]);let D=async(e,t)=>{try{var i;let s=null!==(i=null==t?void 0:t.deviceId)&&void 0!==i?i:await (0,o.Zws)(l.selectedDevice);if((0,r.isVideoTransformDevice)(l.selectedDevice)){if(Z(!0),"chooseNewInnerDevice"in l.selectedDevice)s=selectedDevice.chooseNewInnerDevice(deviceId);else throw"Transform device cannot choose new inner device"}n.isVideoEnabled?await d.startVideoInputDevice(s):d.selectVideoInputDevice(s),e!==n.isVideoEnabled&&n.toggleVideo()}catch(e){console.error("Failed to select video input device")}finally{Z(!1)}},I=async(e,n)=>{var i;let r=await (0,o.Zws)(c.selectedDevice),s=null!==(i=null==n?void 0:n.deviceId)&&void 0!==i?i:r;s!==r&&await d.startAudioInputDevice(s),t.muted===e&&t.toggleMute()};return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(a.Z,{direction:e.orientation,videoEnabled:u,audioEnabled:p,showConfigMenu:!1,videoDevice:m,audioDevice:g,videoDevices:b,audioDevices:j,onVideoPreferenceChange:D,onAudioPreferenceChange:I,busy:k})})}},43670:function(e,t,n){n.d(t,{Z:function(){return w}});var i,o,r=n(57437),s=n(11144),a=n(70883),l=n(5085),c=n(23447),d=n(94547),u=n(83593),h=n(31193),p=n(96537),x=n(27270),m=n(40468),f=n(6722),g=n(8963),y=n(2265),b=n(11707);(i=o||(o={}))[i.Init=0]="Init",i[i.FetchingAttendeeData=1]="FetchingAttendeeData",i[i.AttendeeDataRetrieved=2]="AttendeeDataRetrieved",i[i.AttendeeDataError=3]="AttendeeDataError",i[i.MeetingConnecting=4]="MeetingConnecting",i[i.MeetingConnected=5]="MeetingConnected",i[i.MeetingStarting=6]="MeetingStarting",i[i.MeetingStarted=7]="MeetingStarted",i[i.MeetingLeft=8]="MeetingLeft",i[i.MeetingUnavailable=9]="MeetingUnavailable",i[i.ChimeError=10]="ChimeError",i[i.ConnectedOnAnotherDevice=11]="ConnectedOnAnotherDevice";let v={unexpected:!1,anotherDevice:!1,unavailable:!1,left:!1},j={deviceLabels:f.C$T.AudioAndVideo};function w(e){let[t,n]=(0,y.useState)(0),[i,w]=(0,y.useState)(),[k,Z]=(0,y.useState)(),[S,C]=(0,y.useState)(),[D,I]=(0,y.useState)(v),{session:E}=(0,y.useContext)(s.z),{deviceId:A,role:q,sessionToken:P,user:T}=(0,y.useContext)(l.rZ),_=(0,f.fjl)(),{isVideoEnabled:F,toggleVideo:R}=(0,f.Onx)(),{muted:B,toggleMute:U}=(0,f.HI)(),{api:V,start:M}=(0,y.useContext)(c.E),{subscriptions:N,thisUser:O}=(0,y.useContext)(a.l),[W,K]=(0,y.useState)({}),[L,z]=(0,y.useState)(!1),[G,H]=(0,y.useState)(),[J,Y]=(0,y.useState)();(0,y.useEffect)(()=>(u.Z.on(u.M.WSS_Distribute_Message,Y),u.Z.on(u.M.Media_Playback_Update,Y),()=>{u.Z.off(u.M.WSS_Distribute_Message,Y),u.Z.off(u.M.Media_Playback_Update,Y)}),[]),(0,y.useEffect)(()=>{if(void 0!==J)switch(J.type){case u.M.WSS_Distribute_Message:Q(J.data);break;case u.M.Media_Playback_Update:X(J.data)}},[J]);let X=e=>{K({...W,[e.videoId]:{update:e}})};(0,y.useEffect)(()=>{z(Object.entries(W).some(e=>e[1].update.isPlaying))},[W]),(0,y.useEffect)(()=>{L&&(H(B),B||U()),L||void 0===G||B===G||U()},[L]);let Q=e=>{"mute-update"===e.type&&$(e.data.pids)},$=e=>{!B&&(e.some(e=>e===(null==O?void 0:O.deviceId))||e.some(e=>"*"===e))&&U()};(0,y.useEffect)(()=>{var t,n;(null===(t=e.initialCallPreferences)||void 0===t?void 0:t.videoDevice)!==void 0&&_.startVideoInputDevice(e.initialCallPreferences.videoDevice.deviceId),(null===(n=e.initialCallPreferences)||void 0===n?void 0:n.audioDevice)!==void 0&&_.startAudioInputDevice(e.initialCallPreferences.audioDevice.deviceId)},[]);let ee=(0,y.useCallback)(async(e,t)=>{void 0===t&&console.warn("Undefined pid passed from chime.");var n,i=N.find(e=>e.deviceId===t);return void 0===i&&console.warn("No subscription found for pid: ".concat(t),N),{name:null!==(n=null==i?void 0:i.participantName)&&void 0!==n?n:"Unknown"}},[N]);(0,y.useEffect)(()=>{_.getAttendee=ee,_.updateDeviceLists()},[N]),(0,y.useEffect)(()=>(_.subscribeToMeetingStatus(et),()=>{_.getAttendee=void 0,_.leave(),_.unsubscribeFromMeetingStatus(et)}),[]);let et=e=>{console.debug("Meeting status: ".concat(f.ytK[e])),C(e)},en=q===d._b.Controller||E.facilitationState===d._y.Open;(0,y.useEffect)(()=>{en&&0!==t&&1!==t&&n(1),en||(console.debug("Disconnecting..."),Z(null))},[E.facilitationState]),(0,y.useEffect)(()=>{switch(console.debug("ZgMeeting view state: ".concat(o[t])),t){case 0:en&&n(1);break;case 1:I(v),ei().then(e=>{(null==e?void 0:e.chimeMeetingId)!==(null==i?void 0:i.chimeMeetingId)&&w(e),e?n(2):n(3)}).catch(e=>{console.error(e)});break;case 2:I(v),n(4);break;case 3:case 10:I({...v,unexpected:!0});break;case 4:I(v);let e=eo();(null==k?void 0:k.meetingId)!==e.meetingId||S!==f.ytK.Succeeded?Z(e):n(5);break;case 5:I(v),n(6);break;case 6:I(v),er();break;case 7:I(v);break;case 9:q===d._b.Controller?(I(v),n(1)):I({...v,unavailable:!0});break;case 8:I({...v,left:!0});break;case 11:I({...v,anotherDevice:!0})}},[t,E.facilitationState]);let ei=async()=>{var e;return await M(V.postMeetingJoinRequest(E.id,P,A,null!==(e=null==O?void 0:O.participantName)&&void 0!==e?e:"unknown",null==T?void 0:T.access_token))},eo=()=>new g.MeetingSessionConfiguration({MeetingId:i.chimeMeetingId,MediaPlacement:{AudioHostUrl:i.audioHostUrl,SignalingUrl:i.signalingUrl,TurnControlUrl:i.turnControlUrl,AudioFallbackUrl:i.audioFallbackUrl,EventIngestionUrl:i.eventIngestionUrl,ScreenDataUrl:i.screenDataUrl,ScreenViewingUrl:i.screenViewingUrl}},{ExternalUserId:i.chimeAttendeeExternalId,AttendeeId:i.chimeAttendeeId,JoinToken:i.chimeJoinToken});(0,y.useEffect)(()=>{null!=k?_.join(k,j).then(()=>{n(5)}):_.leave()},[null==k?void 0:k.meetingId]),(0,y.useEffect)(()=>{switch(S){case f.ytK.Loading:break;case f.ytK.Succeeded:n(7);break;case f.ytK.Reconnecting:n(4);break;case f.ytK.Left:n(8);break;case f.ytK.Failed:n(10);break;case f.ytK.Ended:n(9);break;case f.ytK.TerminalFailure:n(10);break;case f.ytK.JoinedFromAnotherDevice:n(11)}},[S]);let er=async()=>{console.debug("Starting the meeting from state: ".concat(void 0!==S?f.ytK[S]:"undefined"));try{await _.start(),n(7)}catch(e){console.error(e),n(10)}};return(0,y.useEffect)(()=>{S!==f.ytK.Succeeded||(e.initialCallPreferences?(e.initialCallPreferences.videoEnabled!==F&&R(),e.initialCallPreferences.audioEnabled===B&&U()):F||R())},[S]),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(h.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",...e.sx},children:[D.unexpected&&(0,r.jsx)("p",{children:"An unexpected error prevented us from connecting you to the video call. Please refresh the page."}),D.anotherDevice&&(0,r.jsx)("p",{children:"You are already connected in another tab. Please close any other browser tabs connected to this workshop."}),D.unavailable&&(0,r.jsx)("p",{children:"The video call is not available at this time. Please try again later."}),D.left&&(0,r.jsx)("p",{children:"You have left the video call."}),11===t&&(0,r.jsx)(p.Z,{variant:"contained",onClick:()=>n(1),children:"Try again"}),3===t&&(0,r.jsx)(p.Z,{variant:"contained",onClick:()=>n(1),children:"Try again"}),9===t&&(0,r.jsx)(p.Z,{variant:"contained",onClick:()=>n(1),children:"Try again"}),8===t&&(0,r.jsx)(p.Z,{variant:"contained",onClick:()=>n(1),children:"Rejoin"}),10===t&&(0,r.jsx)(p.Z,{variant:"contained",onClick:()=>n(4),children:"Try again"}),-1===[7,8,9,10,11].indexOf(t)&&(0,r.jsx)(x.Z,{severity:"info",icon:(0,r.jsx)(m.Z,{size:"1rem"}),children:"Please wait..."}),S===f.ytK.Succeeded&&(0,r.jsx)(b.f6,{theme:f.Wbj,children:(0,r.jsx)(h.Z,{sx:{alignSelf:"stretch",flexGrow:1},children:e.children})})]})})}},69161:function(e,t,n){n.d(t,{Z:function(){return l}});var i=n(57437),o=n(4087),r=n(31193),s=n(80511),a=n(96537);function l(e){let t=!0===e.white?"white":"black",n=!0===e.white?{filter:"invert(100%) sepia(3%) saturate(594%) hue-rotate(149deg) brightness(117%) contrast(100%)"}:void 0;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(r.Z,{sx:{mb:2},children:[e.welcome&&(0,i.jsx)(s.Z,{variant:"body1",color:t,children:(0,i.jsx)(o.Z,{i18nKey:"onboarding.welcomeTo"})}),(0,i.jsx)(s.Z,{variant:"h3",component:"h2",color:t,children:e.session.sessionName})]}),(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column"===e.layout?"column":"row"},gap:2,children:[(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"column"===e.layout?"start":"center",gap:1},children:[(0,i.jsx)("img",{src:"/icons/session-date.svg",style:n}),(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column"===e.layout?"column":"row",alignItems:"column"===e.layout?"flex-start":"center",gap:1},children:[(0,i.jsx)(s.Z,{variant:"body2",color:t,children:(0,i.jsx)(o.Z,{i18nKey:"label.date"})}),(0,i.jsx)(s.Z,{variant:"body1",style:{fontWeight:"bold"},color:t,children:new Date(e.session.sessionStartTime).toDateString()})]})]}),(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"column"===e.layout?"start":"center",gap:1},children:[(0,i.jsx)("img",{src:"/icons/session-time.svg",style:n}),(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column"===e.layout?"column":"row",alignItems:"column"===e.layout?"flex-start":"center",gap:1},children:[(0,i.jsx)(s.Z,{variant:"body2",color:t,children:(0,i.jsx)(o.Z,{i18nKey:"label.time"})}),(0,i.jsx)(s.Z,{variant:"body1",style:{fontWeight:"bold"},color:t,children:new Date(e.session.sessionStartTime).toLocaleTimeString()})]})]})]}),void 0!==e.onAdvance&&(0,i.jsx)(a.Z,{variant:"contained",color:"primary",onClick:e.onAdvance,sx:{alignSelf:"start"},children:"Next"})]})}},16003:function(e,t,n){n.d(t,{ui:function(){return B},ZP:function(){return U}});var i=n(57437),o=n(11144),r=n(5085),s=n(94547),a=n(83593),l=n(4087),c=n(64363),d=n(9646),u=n(40772),h=n(28125),p=n(56798),x=n(65392),m=n(31193),f=n(27270),g=n(80511),y=n(79617),b=n(51847),v=n(33578),j=n(6722),w=n(8963),k=n(2265),Z=n(11707),S=n(71601),C=n(20920);let D=()=>new w.MeetingSessionConfiguration({MeetingId:"dummy meeting id",MediaPlacement:{}},{AttendeeId:(0,C.Z)()});var I=n(41665),E=n(19783),A=n(25566);function q(){let e=!!A.env.NEXT_PUBLIC_SITE_SIGNUP_URL,t="collective.intelligence@nesta.org.uk",[n,o]=(0,k.useState)();return(0,k.useEffect)(()=>{if(e){let e="".concat(window.location.host,"/signup");E.toDataURL(e).then(e=>{o(e)}).catch(e=>{o(void 0),console.error(e)})}},[]),(0,i.jsxs)(m.Z,{color:"#fff",sx:{display:"flex",flexDirection:"column",gap:"1.5vh"},children:[(0,i.jsx)(g.Z,{component:"h1",variant:"h3",sx:{fontWeight:"bold"},children:"This workshop is now closed, but please join us for a future session."}),(0,i.jsx)(g.Z,{component:"h2",variant:"h5",children:"Use one of the methods below to register, and please share with friends and family."}),n&&(0,i.jsxs)(m.Z,{children:[(0,i.jsx)(g.Z,{children:"Scan the QR code"}),(0,i.jsx)("img",{src:n,style:{borderRadius:"5px",marginTop:"0.5rem",height:"175px",width:"175px"}})]}),e&&(0,i.jsxs)(m.Z,{children:[(0,i.jsx)(g.Z,{sx:{borderTop:"1px solid #fff;",paddingTop:"1rem"},children:"Visit the website"}),(0,i.jsx)(I.Z,{href:"/signup",target:"_blank",variant:"h5",color:"#fff",children:"situation-room.app/signup"})]}),(0,i.jsxs)(m.Z,{children:[(0,i.jsx)(g.Z,{sx:{borderTop:"1px solid #fff;",paddingTop:"1rem"},children:"Email us at"}),(0,i.jsx)(I.Z,{href:"mailto:".concat(t),target:"_blank",variant:"h5",color:"#fff",children:t})]})]})}var P=n(69161);let T=e=>e.facilitationState===s._y.Open,_=e=>e.facilitationState===s._y.Closed,F=e=>e.remoteConfiguration===s.VS.RemoteWithVideoCall,R={videoEnabled:!0,audioEnabled:!0,videoDevice:void 0,audioDevice:void 0,blurBackground:!1},B=(0,k.createContext)({});function U(e){let{session:t}=(0,k.useContext)(o.z),{deviceId:n}=(0,k.useContext)(r.rZ),[C]=(0,k.useState)(()=>new w.ConsoleLogger("ZgLiveSession",w.LogLevel.OFF)),[I,E]=(0,k.useState)(!F(t)),[A,U]=(0,k.useState)(T(t)),[V,M]=(0,k.useState)(!1),[N,O]=(0,k.useState)(!1),[W,K]=(0,k.useState)(!0),[L,z]=(0,k.useState)(!0),[G,H]=(0,k.useState)(R);t.remoteConfiguration,s.VS.RemoteWithVideoCall,(0,k.useEffect)(()=>{H({...G,videoEnabled:W,audioEnabled:L})},[W,L]),(0,k.useEffect)(()=>{e.onJoinIntention(I)},[I]),(0,k.useEffect)(()=>{U(T(t))},[t]),(0,k.useEffect)(()=>{O(I&&(A||e.role===s._b.Controller)&&(!V||e.role===s._b.Controller))},[A,I,e.role,V]),(0,k.useEffect)(()=>{void 0!==t.deviceIdBanList&&M(t.deviceIdBanList.includes(n))},[t,n]);let J=()=>(0,i.jsxs)(m.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[_(t)&&(0,i.jsx)(f.Z,{severity:"warning",children:(0,i.jsx)(l.Z,{i18nKey:"onboarding.thisWorkshopIsClosed"})}),T(t)&&!I&&(0,i.jsxs)(f.Z,{severity:"success",children:[(0,i.jsx)(l.Z,{i18nKey:"onboarding.thisWorkshopIsOpen"}),(0,i.jsx)("br",{}),(0,i.jsx)(l.Z,{i18nKey:"onboarding.pressJoinToEnter"})]}),V&&(0,i.jsx)(f.Z,{severity:"error",children:(0,i.jsx)(l.Z,{i18nKey:"onboarding.youAreRemoved"})})]}),Y=e=>{let{visible:t}=e,n=(0,j.fjl)(),o=(0,k.useRef)(!1),r=(0,k.useRef)(!1);return(0,k.useEffect)(()=>{r.current||(o.current=!0,n.join(D()).then(()=>{r.current=!0}).catch(e=>{console.error(e)}).finally(()=>{o.current=!1}))},[]),(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(m.Z,{sx:{borderRadius:"0.5rem",overflow:"hidden",background:"#222222"},className:"shadow",children:(0,i.jsx)(m.Z,{sx:{opacity:t?1:0},children:(0,i.jsx)(j.Q_v,{})})})})},[X,Q]=(0,k.useState)(!1),[$,ee]=(0,k.useState)(!1),[et,en]=(0,k.useState)(!1),ei=()=>{a.Z.emit({type:a.M.WSS_Refresh_Session}),ee(!0),setTimeout(()=>{ee(!1),Q(!0)},2e3)};(0,k.useEffect)(()=>{X&&setTimeout(()=>{en(!0)},3e3)},[X]);let[eo]=(0,u.u)(),er=t.facilitationState===s._y.Closed&&e.role===s._b.Client;return(0,i.jsxs)(i.Fragment,{children:[F(t)&&(!N||V)&&(0,i.jsx)(j.ikO,{logger:C,children:(0,i.jsx)(j.lUb,{children:(0,i.jsx)(S.Z,{background:!!er,rightPanel:er?null:(0,i.jsx)(()=>(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(m.Z,{sx:{flexGrow:1,flexBasis:0,display:"flex",flexDirection:"column",justifyContent:"start",p:2,gap:2},children:[(0,i.jsx)(m.Z,{children:(0,i.jsxs)(Z.f6,{theme:j.Wbj,children:[(0,i.jsx)(j.nz8,{}),(0,i.jsx)(Y,{visible:W})]})}),(0,i.jsxs)(m.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:[(0,i.jsx)(c.Z,{direction:"row",videoEnabled:W,audioEnabled:L,onVideoPreferenceChange:async(e,t)=>{K(e)},onAudioPreferenceChange:async(e,t)=>{z(e)},busy:!1,showConfigMenu:!1,videoDevice:void 0,audioDevice:void 0,videoDevices:[],audioDevices:[]}),(0,i.jsx)(d.Z,{btnKey:"join",variant:I?"outlined":"contained",onClick:()=>E(!I),btnText:I?(0,i.jsx)(l.Z,{i18nKey:"onboarding.leaveCall"}):(0,i.jsx)(l.Z,{i18nKey:"onboarding.joinCall"})})]})]})}),{}),children:er?(0,i.jsx)(q,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(g.Z,{variant:"body1",color:"white",children:(0,i.jsx)(l.Z,{i18nKey:"onboarding.youAreAboutToJoin"})}),(0,i.jsx)(P.Z,{session:t,welcome:!1,layout:"column",white:!0}),(0,i.jsxs)(m.Z,{sx:{display:"flex",flexDirection:"column",gap:1,mt:4},children:[(0,i.jsx)(J,{}),I&&!T(t)&&!_(t)&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f.Z,{severity:"info",children:(0,i.jsx)(l.Z,{i18nKey:"onboarding.waitingForOpen"})}),(0,i.jsxs)(y.Z,{children:[(0,i.jsx)(b.Z,{expandIcon:(0,i.jsx)(h.Z,{}),"aria-controls":"support-panel-content",id:"support-panel",children:(0,i.jsx)(g.Z,{variant:"body1",children:(0,i.jsx)(l.Z,{i18nKey:"onboarding.supportInfoHeading"})})}),(0,i.jsx)(v.Z,{children:(0,i.jsxs)(m.Z,{sx:{display:"flex",flexDirection:"column",gap:1},ref:eo,children:[(0,i.jsx)(g.Z,{variant:"body2",children:(0,i.jsx)(l.Z,{i18nKey:"onboarding.supportInfoText1"})}),(0,i.jsx)(d.Z,{variant:"outlined",btnKey:"reconnect",size:"small",busy:$,startIcon:(0,i.jsx)(p.Z,{}),onClick:()=>{ei()},btnText:(0,i.jsx)(l.Z,{i18nKey:"button.reconnect"})}),et&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(g.Z,{variant:"body2",children:(0,i.jsx)(l.Z,{i18nKey:"onboarding.supportInfoText2"})}),(0,i.jsx)(d.Z,{variant:"outlined",btnKey:"reconnect",size:"small",startIcon:(0,i.jsx)(x.Z,{}),onClick:()=>window.location.reload(),btnText:(0,i.jsx)(l.Z,{i18nKey:"button.reload"})})]})]})})]})]})]})]})})})}),!F(t)&&(!N||V)&&(0,i.jsx)(S.Z,{background:!0,children:er?(0,i.jsx)(q,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(g.Z,{variant:"body1",color:"white",children:(0,i.jsx)(l.Z,{i18nKey:"onboarding.youAreAboutToJoin"})}),(0,i.jsx)(P.Z,{session:t,welcome:!1,layout:"column",white:!0}),(0,i.jsx)(m.Z,{sx:{display:"flex",flexDirection:"column",gap:1,mt:4},children:(0,i.jsx)(J,{})}),!T(t)&&(0,i.jsx)(f.Z,{severity:"info",children:(0,i.jsx)(l.Z,{i18nKey:"onboarding.waitingForOpen"})})]})}),F(t)&&N&&!V&&(0,i.jsx)(j.ikO,{logger:C,children:(0,i.jsx)(j.lUb,{children:(0,i.jsx)(B.Provider,{value:{call:G},children:e.children})})}),!F(t)&&N&&!V&&(0,i.jsx)(i.Fragment,{children:e.children})]})}},96608:function(e,t,n){n.d(t,{Z:function(){return s}});var i=n(57437),o=n(80511),r=n(33351);function s(){return(0,i.jsxs)(r.Z,{component:"main",sx:{display:"flex",flexDirection:"column",gap:"1rem",padding:"1rem"},children:[(0,i.jsx)(o.Z,{variant:"h1",sx:{fontSize:"2.25rem"},children:"The Situation Room"}),(0,i.jsxs)(o.Z,{variant:"body1",children:["Thanks for trying to join ",(0,i.jsx)("b",{children:"The Situation Room"}),"."]}),(0,i.jsxs)(o.Z,{variant:"body1",children:["Unfortunately, ",(0,i.jsx)("b",{children:"you can't use a phone"})," (or other device with a small screen) to take part in the session."]}),(0,i.jsxs)(o.Z,{variant:"body1",children:[(0,i.jsx)("b",{children:"Please use a laptop, tablet"})," or other similar device to join."]})]})}},81764:function(e,t,n){n.d(t,{Z:function(){return eC}});var i=n(57437),o=n(46027),r=n(90089),s=JSON.parse('{"button":{"continue":"CONTINUE","getStarted":"GET STARTED","reconnect":"Reconnect","reload":"Reload page","submit":"Submit","goFullScreen":"Go full screen","exitFullScreen":"Exit full screen","unsure":"Unsure"},"label":{"date":"DATE","time":"TIME"},"field":{"yourName":"Your name"},"onboarding":{"welcomeTo":"WELCOME TO","loadingWorkshop":"Loading workshop information...","almostThere":"Almost there","pleaseEnterName":"Please enter your name","pleaseEnterNameExplanation":"This is so we know what to call you during the session, your name will not be saved or stored","thanks":"THANKS","youAreAboutToJoin":"YOU ARE ABOUT TO JOIN","thisWorkshopIsClosed":"This workshop is closed.","thisWorkshopIsOpen":"This workshop is open.","pressJoinToEnter":"Press JOIN CALL to enter.","youAreRemoved":"You have been removed from this workshop.","joinCall":"JOIN CALL","leaveCall":"LEAVE CALL","waitingForOpen":"Waiting for the host to begin the session. Please wait...","supportInfoHeading":"Support information","supportInfoText1":"If your workshop start time has passed and you are still waiting to enter the workshop, it\'s possible your device has become disconnected. Please check your internet connection, and use the reconnect button to try again.","supportInfoText2":"If you are still unable to enter the workshop, please check your invite for technical support contact information. We may ask you to reload the page."},"poll":{"pointsAllocation":{"remaining":"{{numberOfPoints}} points remaining"},"upDown":{"notSure":"Unsure"}},"video":{"videoInitFailed":"Video failed to initialise.","videoManualControl":"Please use the video controls to start your video.","videoReadiness":"Your facilitator will start the video as soon as everybody is ready..."},"upDownResult":{"divisiveDescription":"These statements split the room...","supportedDescription":"Most people agreed with...","opposedDescription":"Most people disagreed with...","unansweredDescription":"Most did not answer..."}}'),a=JSON.parse('{"button":{"continue":"DEVAM ET","getStarted":"Başlayın","reconnect":"Tekrar bağlan","submit":"G\xf6nder","goFullScreen":"Tam ekran moduna ge\xe7","exitFullScreen":"Tam ekranı kapat","unsure":"Emin değilim"},"label":{"date":"Tarih","time":"Saat"},"field":{"yourName":"Adınız"},"onboarding":{"welcomeTo":"Hoş Geldiniz","loadingWorkshop":"At\xf6lye bilgilerini y\xfckl\xfcyor...","almostThere":"Neredeyse bitti","pleaseEnterName":"L\xfctfen adınızı girin","pleaseEnterNameExplanation":"Bu, seans sırasında size nasıl hitap edeceğimizi bilmek i\xe7indir, adınız kaydedilmeyecek veya saklanmayacaktır","thanks":"Teşekk\xfcrler","youAreAboutToJoin":"Katılmak \xfczeresiniz","waitingForOpen":"Sunucuyu seansı başlatmayı bekliyor. L\xfctfen bekleyin."},"poll":{"pointsAllocation":{"remaining":"{{numberOfPoints}} puan kaldı"},"upDown":{"notSure":"Emin değilim"}},"video":{"videoInitFailed":"Video başlatılamadı","videoManualControl":"Videonuzu başlatmak i\xe7in video kontrollerini kullanın l\xfctfen","videoReadiness":"Kolaylaştırıcınız herkes hazır olduğunda videoyu başlatacak..."}}'),l=e=>(o.ZP.isInitialized||o.ZP.use(r.Db).init({resources:{en:{common:s},tr:{common:a}},lng:null!=e?e:"tr",fallbackLng:"en",defaultNS:"common"}),o.ZP),c=n(2265),d=n(53622),u=n(31193),h=n(11144),p=n(37471),x=n(67506),m=n(70883),f=n(4766),g=n(93191),y=n(5085),b=n(30496),v=n(37570),j=n(23447),w=n(94547),k=n(4087);function Z(e){let{keepAwake:t}=e,[n,o]=(0,c.useState)(),[r,s]=(0,c.useState)();return(0,c.useEffect)(()=>{if(void 0===n&&void 0!==window.navigator){var e;o(null===(e=window.navigator)||void 0===e?void 0:e.wakeLock)}},[]),(0,c.useEffect)(()=>{console.debug("Wake lock: ".concat(void 0===n?"unavailable":"available",", keepAwake: ").concat(t));try{void 0===n||(t&&void 0===r&&n.request("screen").then(e=>{console.debug("Wake lock sentinel acquired"),s(e)}).catch(e=>{console.error("Wake lock exception",e)}),t||(void 0!==r&&console.debug("Releasing wake lock sentinel..."),null==r||r.release().then(()=>{console.debug("Wake lock sentinel released."),s(void 0)})))}catch(e){console.warn("Unable to request screen lock",e)}return()=>{void 0!==r&&console.debug("Relesaing wake lock sentinel..."),null==r||r.release().then(()=>{console.debug("Wake lock sentinel released."),s(void 0)})}},[n,t]),(0,i.jsx)(i.Fragment,{})}function S(e){let{children:t}=e;return(0,i.jsx)(u.Z,{sx:{position:"fixed",right:"1.5rem",bottom:"1.5rem",zIndex:10},children:t})}function C(e){let{children:t}=e;return(0,i.jsx)(u.Z,{sx:{position:"fixed",right:"1.5rem",top:"1.5rem",zIndex:10},children:t})}function D(e){let{children:t}=e;return(0,i.jsx)(u.Z,{sx:{position:"fixed",left:"1.5rem",bottom:"1.5rem",zIndex:10},children:t})}var I=n(69779),E=n(48234),A=n(22960),q=n(31655),P=n(60335);function T(e){let{session:t}=(0,c.useContext)(h.z),n=(0,c.useContext)(y.rZ),o=(0,c.useMemo)(()=>{var t;return(null===(t=e.elementRef)||void 0===t?void 0:t.current)||document.documentElement},[e.elementRef]),[r,s]=(0,c.useState)(),a=async()=>{try{!1!==document.fullscreenEnabled?o.requestFullscreen?await o.requestFullscreen({navigationUI:"hide"}):o.webkitRequestFullscreen?await o.webkitRequestFullscreen():o.webkitEnterFullscreen?await o.webkitEnterFullscreen():o.mozRequestFullScreen?await o.mozRequestFullScreen():o.msRequestFullscreen?await o.msRequestFullscreen():console.warn("No request full screen variants found"):console.warn("Fullscreen not enabled")}catch(e){console.error("Error entering fullscreen",e)}},l=async()=>{try{let e=document;document.fullscreenElement?await document.exitFullscreen():e.webkitFullscreenElement?await e.webkitExitFullscreen():e.mozFullScreenElement?await e.mozCancelFullScreen():e.msFullscreenElement?await e.msExitFullscreen():console.warn("No exit full screen variants found")}catch(e){console.error("Error exiting fullscreen",e)}};(0,c.useEffect)(()=>{document.onfullscreenchange=e=>{s(null!==document.fullscreenElement)}},[]),(0,c.useEffect)(()=>{n.role===w._b.Client&&void 0!==o&&(e.goFullScreen&&!r&&t.facilitationState!==w._y.Closed&&a(),!e.goFullScreen&&r&&l())},[e.goFullScreen,o]),(0,c.useEffect)(()=>{t.facilitationState===w._y.Closed&&(console.debug("Session closed: exit fullscreen"),l())},[t.facilitationState]);let d=(0,A.Z)();return(0,i.jsx)(i.Fragment,{children:n.role===w._b.Client&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(q.Z,{title:r?(0,i.jsx)(k.Z,{i18nKey:"button.exitFullScreen"}):(0,i.jsx)(k.Z,{i18nKey:"button.goFullScreen"}),children:(0,i.jsx)(P.Z,{"aria-label":r?"back to desktop":"go full screen",onClick:()=>r?l():a(),sx:{border:"2px solid",borderColor:d.palette.promptPanelBackground.main,background:d.palette.slideSectionBackground.main,opacity:.75,"&:hover":{backgroundColor:d.palette.slideSectionBackground.main,opacity:1}},children:r?(0,i.jsx)(E.Z,{}):(0,i.jsx)(I.Z,{})})})})})}var _=n(53771),F=n(27270);let R=[w.um.Error,w.um.Disconnected,w.um.Disconnecting,w.um.Offline],B=[w.um.Online,w.um.Connecting,w.um.Connected,w.um.Joining];function U(){let e=(0,c.useContext)(m.l),t=(0,c.useContext)(p.Z),[n,o]=(0,c.useState)(e.thisUser),[r,s]=(0,c.useState)(t.state),[a,l]=(0,c.useState)(R.includes(r)),[d,u]=(0,c.useState)(B.includes(r)),[h,x]=(0,c.useState)("TODO"),[f,g]=(0,c.useState)(0);return(0,c.useEffect)(()=>{o(e.thisUser)},[e]),(0,c.useEffect)(()=>{console.debug("Connection warning, state: ".concat(w.um[t.state])),s(t.state)},[t.state,n]),(0,c.useEffect)(()=>{let e=R.includes(r),t=B.includes(r);e&&x("Disconnected from the workshop server."),t&&x("Please wait, connecting to the workshop server..."),l(e),u(t)},[r]),(0,c.useEffect)(()=>{g(a||d?1:0)},[a,d]),(0,i.jsxs)(F.Z,{variant:"filled",severity:a?"warning":"info",sx:{opacity:f},children:[h," (",w.um[r],")"]})}var V=n(56798),M=n(83593);function N(e){let[t,n]=(0,c.useState)(!1),[o,r]=(0,c.useState)();(0,c.useEffect)(()=>(M.Z.on(M.M.WSS_Update_ConnectionState,r),()=>{M.Z.off(M.M.WSS_Update_ConnectionState,r)}),[]),(0,c.useEffect)(()=>{void 0!==o&&o.type===M.M.WSS_Update_ConnectionState&&o.data>=w.um.Connecting&&n(!0)},[o]);let s=()=>{switch(e.mode){case"reconnect-wss":M.Z.emit({type:M.M.WSS_Request_Reconnect});break;case"reload-session":M.Z.emit({type:M.M.WSS_Refresh_Session})}},a=(0,A.Z)();return(0,i.jsx)(i.Fragment,{children:t&&(0,i.jsx)(q.Z,{title:(0,i.jsx)(k.Z,{i18nKey:"button.reconnect"}),children:(0,i.jsx)(P.Z,{"aria-label":"refresh",onClick:()=>s(),sx:{border:"2px solid",borderColor:a.palette.promptPanelBackground.main,background:a.palette.slideSectionBackground.main,opacity:.75,"&:hover":{backgroundColor:a.palette.slideSectionBackground.main,opacity:1}},children:(0,i.jsx)(V.Z,{})})})})}function O(){let{session:e}=(0,c.useContext)(v.H);return(0,c.useEffect)(()=>{document.title=e.sessionName},[]),(0,i.jsx)(i.Fragment,{})}var W=n(33351);function K(e){return(0,i.jsx)(i.Fragment,{children:e.role===w._b.Client&&(0,i.jsx)(W.Z,{sx:{display:"flex",alignItems:"center",flexDirection:"row",gap:1},children:e.children})})}function L(){return(0,c.useEffect)(()=>{let e=[/defaultProps/,/of chart should be greater than 0/,/It will be ignored./,/If you accidentally passed it from a parent component, remove it from the DOM element./,/Form submission canceled because the form is not connected/,/Violation/,/Enriching/,/Added non-passive event/,/Form submission canceled/,/\[Violation\]/,/Warning: Invalid DOM/],t=console.error,n=console.warn,i=console.debug;return console.error=function(){for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];"string"==typeof i[0]&&e.some(e=>e.test(i[0]))||t(...i)},console.warn=function(){for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];"string"==typeof i[0]&&e.some(e=>e.test(i[0]))||n(...i)},console.debug=function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];"string"==typeof n[0]&&e.some(e=>e.test(n[0]))||i(...n)},()=>{console.error=t,console.warn=n,console.debug=i}},[]),(0,i.jsx)(i.Fragment,{})}var z=n(80511),G=n(99128),H=n(71601);function J(e){let[t,n]=(0,c.useState)(),[o,r]=(0,c.useState)({overall:{completed:0,total:0},bars:{}});return(0,c.useEffect)(()=>(M.Z.on(M.M.Content_Progress_Update,n),()=>{M.Z.off(M.M.Content_Progress_Update,n)}),[]),(0,c.useEffect)(()=>{void 0!==t&&t.type===M.M.Content_Progress_Update&&r(t.data)},[t]),(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(H.Z,{children:(0,i.jsxs)(u.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.preTitle&&(0,i.jsx)(z.Z,{variant:"body1",color:"white",children:e.preTitle}),e.title&&(0,i.jsx)(z.Z,{variant:"h3",component:"h2",color:"white",children:e.title}),(0,i.jsx)(G.Z,{sx:{mt:4,backgroundColor:"#444444","& .MuiLinearProgress-bar":{backgroundColor:"white"}},value:o.overall.total>0?100*o.overall.completed/o.overall.total:void 0,variant:o.overall.total>0?"determinate":"indeterminate"}),e.bar&&(0,i.jsx)(z.Z,{variant:"body2",color:"white",children:e.bar})]})})})}var Y=n(16003),X=n(27785),Q=n(9646),$=n(69540),ee=n(61570),et=n(87913),en=n(8487),ei=n(86514),eo=n(80438),er=n(67630),es=n(10745),ea=n(44330),el=n(24309),ec=n(63858);let ed={get_request:!1,get_success:!1,get_fail_system:!1,get_fail_user:!1,get_fail_could_not_start:!1,get_fail_unknown_error:!1},eu=e=>e.get_fail_system||e.get_fail_user||e.get_fail_could_not_start||e.get_fail_unknown_error,eh=e=>{let{prompts:t}=e;return(0,i.jsxs)(i.Fragment,{children:[t.get_success&&(0,i.jsx)(F.Z,{severity:"success",children:"Your camera and microphone are ready to go!"}),t.get_request&&(0,i.jsx)(F.Z,{severity:"info",children:"If prompted by your browser, please grant permission to access your camera and microphone."}),t.get_fail_system&&(0,i.jsx)(F.Z,{severity:"error",children:"Your browser has denied access to your camera and microphone. Please check your browser settings and reload the page."}),t.get_fail_user&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(F.Z,{severity:"warning",children:"Your browser has been denied access to your camera and/or microphone."}),(0,i.jsxs)(z.Z,{variant:"h4",component:"h2",color:"white",children:["What to do next on ",ec.KC]}),ec.i7&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(F.Z,{severity:"info",icon:(0,i.jsx)(ee.Z,{fontSize:"inherit"}),children:"If you see a crossed video camera icon at the end of your address bar, click it to change permissions."}),(0,i.jsx)(F.Z,{severity:"info",icon:(0,i.jsx)(et.Z,{fontSize:"inherit"}),children:"If you don't see a camera icon, click the info icon at the beginning of the address bar for the page settings."}),(0,i.jsx)(F.Z,{severity:"info",icon:(0,i.jsx)(en.Z,{fontSize:"inherit"}),children:"Grant permission to access camera and microphone from there."}),(0,i.jsx)(F.Z,{severity:"info",icon:(0,i.jsx)(ei.Z,{fontSize:"inherit"}),children:"When done, reload the page."})]}),ec.vU&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(F.Z,{severity:"info",icon:(0,i.jsx)(ee.Z,{fontSize:"inherit"}),children:"If you see a crossed video camera or microphone icon at the start of your address bar, click it to change permissions."}),(0,i.jsxs)(F.Z,{severity:"info",icon:(0,i.jsx)(eo.Z,{fontSize:"inherit"}),children:["If you don't see those icons, choose ",(0,i.jsx)("b",{children:"Tools"})," > ",(0,i.jsx)("b",{children:"Page Info"})," from the menu."]}),(0,i.jsxs)(F.Z,{severity:"info",icon:(0,i.jsx)(en.Z,{fontSize:"inherit"}),children:["Grant permission to access camera and microphone from the ",(0,i.jsx)("b",{children:"Permissions"})," tab."]}),(0,i.jsx)(F.Z,{severity:"info",icon:(0,i.jsx)(ei.Z,{fontSize:"inherit"}),children:"When done, reload the page."}),(0,i.jsx)("img",{src:"/instructions/permissions-dialog-ff.png",style:{width:"80%",alignSelf:"center"}})]}),ec.G6&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(F.Z,{severity:"info",icon:(0,i.jsx)(eo.Z,{fontSize:"inherit"}),children:["Choose ",(0,i.jsx)("b",{children:"Safari"})," > ",(0,i.jsx)("b",{children:"Settings"})," from the menu, then click ",(0,i.jsx)("b",{children:"Websites"}),"."]}),(0,i.jsxs)(F.Z,{severity:"info",icon:(0,i.jsx)(er.Z,{fontSize:"inherit"}),children:["Choose the Camera settings, and set this site to ",(0,i.jsx)("b",{children:"Allow"}),"."]}),(0,i.jsxs)(F.Z,{severity:"info",icon:(0,i.jsx)(es.Z,{fontSize:"inherit"}),children:["Choose the Microphone settings, and set this site to ",(0,i.jsx)("b",{children:"Allow"}),"."]}),(0,i.jsx)(F.Z,{severity:"info",icon:(0,i.jsx)(ea.Z,{fontSize:"inherit"}),children:"When done, reload the page."}),(0,i.jsx)("img",{src:"/instructions/permissions-dialog-sf.png",style:{width:"80%",alignSelf:"center"}})]}),ec.un&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(F.Z,{severity:"info",icon:(0,i.jsx)(eo.Z,{fontSize:"inherit"}),children:"Select Settings and more... and select Settings."}),(0,i.jsx)(F.Z,{severity:"info",icon:(0,i.jsx)(en.Z,{fontSize:"inherit"}),children:"Select Cookies and Site Permissions on the left side."}),(0,i.jsx)(F.Z,{severity:"info",icon:(0,i.jsx)(ei.Z,{fontSize:"inherit"}),children:"Under Site Permissions, select Camera or Microphone."}),(0,i.jsx)(F.Z,{severity:"info",icon:(0,i.jsx)(ea.Z,{fontSize:"inherit"}),children:"Grant permissions there"}),(0,i.jsx)(F.Z,{severity:"info",icon:(0,i.jsx)(el.Z,{fontSize:"inherit"}),children:"When done, reload this page."})]}),!ec.i7&&!ec.vU&&!ec.G6&&!ec.un&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(F.Z,{severity:"warning",children:["We don't have instructions for ",ec.KC,"."]}),(0,i.jsx)(F.Z,{severity:"info",icon:(0,i.jsx)(eo.Z,{fontSize:"inherit"}),children:"Please grant camera and microphone permissions for this page."}),(0,i.jsx)(F.Z,{severity:"info",icon:(0,i.jsx)(en.Z,{fontSize:"inherit"}),children:"When done, reload the page."})]})]}),t.get_fail_could_not_start&&(0,i.jsx)(F.Z,{severity:"warning",children:"Your camera and microphone are in use by another application. Please close the other application, refresh this page, and try again."}),t.get_fail_unknown_error&&(0,i.jsx)(F.Z,{severity:"error",children:"An unexpected error has prevented us from checking your camera and microphone. Please reload the page to try again."})]})},ep=[{title:"Can we use your microphone and camera during this workshop?",body:"This session will involve participation and discussion, so we will need to use your microphone and camera in order to see and hear you."},{title:"Are you sure?",body:"Unfortunately, without granting access to your microphone and camera you will not be able to participate in the session. Please select below to either allow access, or to navigate out of the session."}];function ex(e){let{session:t}=(0,c.useContext)(v.H),[n,o]=(0,c.useState)(0),[r,s]=(0,c.useState)(ed),[a,l]=(0,c.useState)(!1),[d,h]=(0,c.useState)(!1),p=t.remoteConfiguration===w.VS.RemoteWithVideoCall;(0,c.useEffect)(()=>{p&&(l(!0),x().then(e=>{h(e)}).catch(e=>{console.error(e)}).finally(()=>{l(!1)}))},[]),(0,c.useEffect)(()=>{d&&e.onGrant(!0)},[d]);let x=async()=>{if(void 0===navigator)return console.warn("Navigator required to check permissions"),!1;try{let e=await navigator.permissions.query({name:"camera"});return"granted"===e.state}catch(e){return console.error("Error checking camera permissions",e),!1}},m=async()=>{let e=await f();if(!0===e||!1===e)h(e),s({...ed,get_success:e,get_fail_unknown_error:!e});else{let{type:t,name:n,message:i}=e;h(!1),console.error("Permission denied: ".concat(n,", ").concat(i)),s({...ed,get_success:!1,get_fail_system:t===$.wS.SystemPermissionDenied,get_fail_user:t===$.wS.UserPermissionDenied,get_fail_could_not_start:t===$.wS.CouldNotStartVideoSource,get_fail_unknown_error:null==t||t===$.wS.Generic})}},f=async()=>{try{let e=await (0,$.TD)();if(void 0!==e)return e;throw{type:$.wS.Generic,name:"Unknown",message:"Unknown error"}}catch(e){if(void 0!==e)return e;return{type:$.wS.Generic,name:"Unknown",message:"Unknown error"}}},g=()=>{window.location.reload()};return(0,i.jsxs)(i.Fragment,{children:[!d&&p&&(0,i.jsx)(H.Z,{children:(0,i.jsxs)(u.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"start",gap:2},children:[(0,i.jsx)(z.Z,{variant:"h4",component:"h2",color:"white",children:ep[n].title}),(0,i.jsx)(z.Z,{variant:"body1",color:"white",children:ep[n].body}),(0,i.jsx)(u.Z,{sx:{alignSelf:"stretch",display:"flex",flexDirection:"column",gap:2},children:(0,i.jsx)(eh,{prompts:r})}),(0,i.jsxs)(u.Z,{sx:{mt:4,display:"flex",flexDirection:"column",gap:2},children:[a&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(G.Z,{sx:{mt:4,backgroundColor:"#444444","& .MuiLinearProgress-bar":{backgroundColor:"white"}}}),(0,i.jsx)(z.Z,{variant:"body2",color:"white",children:"Checking for permission..."})]}),!a&&!eu(r)&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Q.Z,{btnKey:"allow",busy:!1,disabled:!1,onClick:m,color:"buttonReverse",btnText:"ALLOW"}),0===n&&(0,i.jsx)(Q.Z,{btnKey:"deny",variant:"text",busy:!1,disabled:!1,onClick:()=>o(1),color:"buttonReverse",btnText:"DO NOT ALLOW"}),1===n&&(0,i.jsx)(Q.Z,{btnKey:"deny",variant:"text",busy:!1,disabled:!1,onClick:()=>g(),color:"buttonReverse",btnText:"EXIT WORKSHOP"})]}),!a&&eu(r)&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(Q.Z,{btnKey:"allow",variant:"outlined",busy:!1,disabled:!1,onClick:()=>{window.location.reload()},color:"buttonReverse",btnText:"RELOAD PAGE"})})]})]})}),(d||!p)&&(0,i.jsx)(i.Fragment,{children:e.children})]})}var em=n(69161);function ef(e){let{children:t}=e,{session:n}=(0,c.useContext)(v.H),[o,r]=(0,c.useState)(!1);return(0,i.jsxs)(i.Fragment,{children:[!o&&(0,i.jsx)(H.Z,{children:(0,i.jsxs)(u.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"start",gap:2},children:[(0,i.jsx)(em.Z,{session:n,layout:"column",welcome:!0,white:!0}),(0,i.jsx)(Q.Z,{color:"buttonReverse",btnText:(0,i.jsx)(k.Z,{i18nKey:"button.getStarted"}),btnKey:"start",onClick:e=>{r(!0)},sx:{mt:4}})]})}),o&&(0,i.jsx)(i.Fragment,{children:t})]})}let eg=e=>e.remoteConfiguration===w.VS.InPerson;function ey(e){let{children:t}=e,{session:n}=(0,c.useContext)(v.H),[o,r]=(0,c.useState)(eg(n));return(0,i.jsxs)(i.Fragment,{children:[!o&&(0,i.jsx)(H.Z,{children:(0,i.jsxs)(u.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"start",gap:2},children:[(0,i.jsx)(z.Z,{variant:"h3",component:"h2",color:"white",children:"We recommend using WiFi rather than mobile data"}),(0,i.jsx)(z.Z,{variant:"body1",color:"white",children:"This session involves watching some video content which requires more data usage. So we recommend you use WiFi so as not to use up too much mobile data."}),(0,i.jsx)(Q.Z,{color:"buttonReverse",btnText:"CONTINUE",btnKey:"start",onClick:e=>{r(!0)},sx:{mt:4}})]})}),o&&(0,i.jsx)(i.Fragment,{children:t})]})}let eb=e=>{let{bar:t}=e;return(0,i.jsx)(J,{preTitle:(0,i.jsx)(k.Z,{i18nKey:"onboarding.welcomeTo"}),title:"Yapay Zeka G\xfcvenlik Etiketi",bar:t})},ev=()=>(0,i.jsx)(J,{preTitle:(0,i.jsx)(k.Z,{i18nKey:"onboarding.thanks"}),title:(0,i.jsx)(k.Z,{i18nKey:"onboarding.almostThere"}),bar:"Synchronizing clocks..."}),ej=()=>(0,i.jsx)(J,{preTitle:(0,i.jsx)(k.Z,{i18nKey:"onboarding.thanks"}),title:(0,i.jsx)(k.Z,{i18nKey:"onboarding.almostThere"}),bar:"Loading workshop content. This may take a few minutes..."}),ew=()=>(0,i.jsx)(J,{preTitle:(0,i.jsx)(k.Z,{i18nKey:"onboarding.thanks"}),title:(0,i.jsx)(k.Z,{i18nKey:"onboarding.almostThere"}),bar:"Connecting you to the workshop..."}),ek=()=>(0,i.jsx)(u.Z,{sx:{width:"100%",height:"100%",border:"solid 4px red"},children:(0,i.jsx)("p",{children:"An error occurred."})}),eZ=(0,c.createContext)({});function eS(e){let{role:t,sid:n,joinCode:o,refresh:r,children:s}=e,[a,l]=(0,c.useState)(!1),[d,I]=(0,c.useState)("Unknown"),[E,A]=(0,c.useState)(!1),[q,P]=(0,c.useState)(!1),F=t===w._b.Controller;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(u.Z,{sx:{width:"100%",height:"100%"},children:(0,i.jsxs)(j.Z,{children:[(0,i.jsx)(S,{children:(0,i.jsx)(_.Z,{})}),(0,i.jsx)(L,{}),(0,i.jsx)(y.ZP,{role:t,sid:n,joinCode:o,load:(0,i.jsx)(eb,{bar:"Checking access to the workshop..."}),err:(0,i.jsx)(ek,{}),children:(0,i.jsxs)(v.Z,{sid:n,init:(0,i.jsx)(eb,{}),load:(0,i.jsx)(eb,{bar:(0,i.jsx)(k.Z,{i18nKey:"onboarding.loadingWorkshop"})}),err:(0,i.jsx)(ek,{}),children:[(0,i.jsx)(O,{}),(0,i.jsxs)(h.Z,{children:[(0,i.jsx)(C,{children:(0,i.jsxs)(K,{role:t,children:[(0,i.jsx)(N,{mode:"reconnect-wss"}),(0,i.jsx)(T,{goFullScreen:a})]})}),(0,i.jsx)(ef,{children:(0,i.jsx)(X.Z,{submitName:I,children:(0,i.jsx)(ex,{onGrant:A,children:(0,i.jsx)(ey,{children:(0,i.jsx)(eZ.Provider,{value:{participantName:d,videoCallPermissionsGranted:E,storagePermissionsGranted:q},children:(0,i.jsx)(x.Z,{mode:"zg-server-time",load:(0,i.jsx)(ev,{}),error:(0,i.jsx)(ek,{}),children:(0,i.jsx)(b.Z,{sid:n,refresh:r,init:(0,i.jsx)(ej,{}),load:(0,i.jsx)(ej,{}),err:(0,i.jsx)(ek,{}),children:(0,i.jsxs)(p.C,{sid:n,load:(0,i.jsx)(ew,{}),error:(0,i.jsx)(ek,{}),children:[(0,i.jsx)(D,{children:(0,i.jsx)(U,{})}),(0,i.jsx)(f.Z,{children:(0,i.jsx)(g.Z,{store:F,refresh:r,previews:!0,children:(0,i.jsx)(m.Z,{sid:n,children:(0,i.jsxs)(Y.ZP,{onJoinIntention:e=>{t!==w._b.Controller&&l(e)},role:t,children:[(0,i.jsx)(Z,{keepAwake:!0}),s]})})})})]})})})})})})})})]})]})})]})})})}function eC(e){let{language:t}=(0,c.useContext)(d.p),[n,o]=(0,c.useState)(l(t));return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(r.a3,{i18n:n,children:(0,i.jsx)(eS,{sid:e.sid,role:e.role,refresh:e.refresh,joinCode:e.joinCode,children:e.children})})})}},53771:function(e,t,n){n.d(t,{Z:function(){return d}});var i=n(57437),o=n(22960),r=n(31193),s=n(40468),a=n(2265),l=n(2057),c=n(23447);function d(e){let{runningTasks:t,waitingTasks:n,failedTasks:d}=(0,a.useContext)(c.E),u=(0,o.Z)(),h={[l.l.Waiting]:u.palette.taskWaiting.main,[l.l.Ready]:u.palette.taskReady.main,[l.l.Running]:u.palette.taskRunning.main,[l.l.Success]:u.palette.taskSuccess.main,[l.l.Failed]:u.palette.taskFailed.main,[l.l.Cancelled]:u.palette.taskCancelled.main},p=e=>{let{task:t}=e,n=t.initProps.indicator,o=!1;switch(t.state){case l.l.Waiting:n+=" (retry)",o=!0;break;case l.l.Ready:case l.l.Running:n+="...",o=!0}return(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"row",gap:1,alignItems:"center",borderRadius:1,backgroundColor:"white",border:1,borderColor:h[t.state],borderBottom:4,borderBottomColor:h[t.state],opacity:.75,py:1,px:2},children:[o&&(0,i.jsx)(s.Z,{size:"1rem"}),n]})};return(0,a.useEffect)(()=>{console.debug("Running tasks: ".concat(t.length))},[t]),(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.showRunning&&t.filter(e=>void 0!==e.initProps.indicator).map(e=>(0,i.jsx)(p,{task:e},"task-vis-".concat(e.id,"-").concat(l.l[e.state]))),n.filter(e=>void 0!==e.initProps.indicator).map(e=>(0,i.jsx)(p,{task:e},"task-vis-".concat(e.id,"-").concat(l.l[e.state])))]})}},40395:function(e,t,n){n.d(t,{Z:function(){return p}});var i=n(57437),o=n(7630),r=n(69065),s=n(80824),a=n(66124),l=n(31193),c=n(60335),d=n(80511),u=n(2265),h=n(9646);function p(e){var t,n,p;let x=()=>{if(!1!==e.dismissible){var t;e.setOpen(!1),null===(t=e.onClose)||void 0===t||t.call(e)}},m=t=>{var n,i;e.setOpen(!1),null===(n=e.onClose)||void 0===n||n.call(e),null===(i=e.onSelect)||void 0===i||i.call(e,t)},f=(0,u.useId)();return(0,u.useEffect)(()=>{console.debug("dialog open",e.open)},[e.open]),(0,i.jsxs)(r.Z,{fullWidth:null===(t=e.fullWidth)||void 0===t||t,maxWidth:null!==(n=e.maxWidth)&&void 0!==n?n:"sm",open:e.open,disableEscapeKeyDown:!e.dismissible,onClose:x,children:[e.title&&(0,i.jsx)(s.Z,{align:"center",children:e.title}),(0,i.jsxs)(a.Z,{children:[(null===(p=e.showCloseButton)||void 0===p||p)&&(0,i.jsx)(l.Z,{style:{position:"absolute",top:0,right:0},children:(0,i.jsx)(c.Z,{"aria-label":"close",onClick:x,children:(0,i.jsx)(o.Z,{})})}),(0,i.jsxs)(l.Z,{sx:{p:2,gap:2,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,i.jsx)(d.Z,{variant:"body1",sx:{width:"75%",mb:2,textAlign:"center",textWrap:"balance"},children:e.prompt}),e.options.map(t=>(0,i.jsx)(h.Z,{btnKey:"dialog-".concat(f,"-option-").concat(t.key),sx:{width:"66%"},variant:t.filled?"contained":"outlined",color:"buttonStandard",onClick:()=>m(t.key),btnText:t.text,busy:e.busy},"dialog-".concat(f,"-option-").concat(t.key)))]})]})]})}},49752:function(e,t,n){n.d(t,{Z:function(){return s}});var i=n(57437),o=n(31193),r=n(9646);function s(e){let t=()=>{var t;return(0,i.jsx)(r.Z,{btnKey:"submit",btnText:e.text,busy:e.busy,disabled:!e.enabled,variant:null!==(t=e.variant)&&void 0!==t?t:"contained",size:!0===e.large?"large":"medium",sx:e.sx,onClick:t=>e.onSubmit?e.onSubmit():null})},n="left"===e.alignment?"flex-start":"right"===e.alignment?"flex-end":"stretch";return(0,i.jsxs)(i.Fragment,{children:[e.inline&&(0,i.jsx)(t,{}),!e.inline&&(0,i.jsx)(o.Z,{sx:e.sx,display:"flex",flexDirection:"row",justifyContent:n,children:(0,i.jsx)(t,{})})]})}},71359:function(e,t,n){n.d(t,{Q:function(){return o},Z:function(){return v}});var i,o,r=n(57437),s=n(8260),a=n(94547),l=n(31193),c=n(22599),d=n.n(c),u=n(2265),h=n(4087),p=n(48620),x=n(49752),m=n(9646),f=n(26049),g=n(45231);(i=o||(o={}))[i.continuous=0]="continuous",i[i.discrete=1]="discrete",i[i.categorical=2]="categorical";let y=(e,t)=>{var n;return{answers:[{key:"".concat(e),index:e,description:null!==(n=null==t?void 0:t[e])&&void 0!==n?n:"".concat(e),numericValue:1}]}},b=()=>({answers:[{key:"unsure",description:"unsure",numericValue:1}]});function v(e){var t;let{answers:n}=(0,s.ZP)(e.qids.qid),i=()=>{var t;return(0,s.Zp)(n,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)},[c,v]=(0,u.useState)(i()),[j,w]=(0,u.useState)(i()),[k,Z]=(0,u.useState)(!1),[S,C]=(0,u.useState)(e.role===a._b.Client);(0,u.useEffect)(()=>{var t;w({...c,jsonValue:null!==(t=c.jsonValue)&&void 0!==t?t:y(Math.floor((E()+A())/2),e.marks)})},[c]);let D=async()=>{if(e.role!==a._b.Client){console.warn("Only participants can submit answers");return}Z(!0),e.onAnswer(j).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)v(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{Z(!1)})},I=async()=>{if(e.role!==a._b.Client){console.warn("Only participants can submit answers");return}Z(!0);let t={...j,jsonValue:b()};e.onAnswer(t).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)v(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{Z(!1)})},E=()=>{switch(e.type){case 2:return 0;case 0:case 1:return e.numericRange?e.numericRange[0]:0;default:throw"Unsupported SliderInputType ".concat(o[e.type])}},A=()=>{switch(e.type){case 2:return e.marks.length-1;case 0:case 1:return e.numericRange?e.numericRange[1]:10;default:throw"Unsupported SliderInputType ".concat(o[e.type])}},q=()=>{var t,n;switch(e.type){case 2:return 1;case 0:return null!==(t=e.numericStep)&&void 0!==t?t:.01;case 1:return null!==(n=e.numericStep)&&void 0!==n?n:1;default:throw"Unsupported SliderInputType ".concat(o[e.type])}},P=e.marks?100-100/e.marks.length:void 0,T=P?"".concat(P,"%"):void 0;return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(l.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,r.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"column",flexGrow:1,alignItems:"center",justifyContent:"center",px:4,gap:8},children:[(0,r.jsx)(l.Z,{children:e.question&&(0,r.jsx)(p.Z,{content:e.question})}),(0,r.jsx)(l.Z,{sx:{width:null!=T?T:"95%"},children:(0,r.jsx)(f.Z,{onCommit:t=>{w({...j,jsonValue:y(t,e.marks)})},color:"secondary",sliderDefault:j.jsonValue?d().toNumber(j.jsonValue.answers[0].index):Math.floor((E()+A())/2),marks:null!==(t=(()=>{switch(e.type){case 2:return e.marks.map((e,t)=>({value:t,label:e}));case 0:return;case 1:return d().range(e.numericRange[0],e.numericRange[1]+1,q()).map((e,t)=>({value:e,label:"".concat(e)}))}})())&&void 0!==t&&t,slots:{markLabel:g.A},min:E(),max:A(),step:q(),sliderMode:"solo"})}),e.showUnsure&&(0,r.jsx)(l.Z,{children:(0,r.jsx)(m.Z,{btnKey:"unsure",btnText:(0,r.jsx)(h.Z,{i18nKey:"button.unsure"}),variant:"outlined",busy:k,disabled:!S,onClick:e=>{I()}})})]}),e.role===a._b.Client&&(0,r.jsx)(l.Z,{children:(0,r.jsx)(x.Z,{onSubmit:D,text:(0,r.jsx)(h.Z,{i18nKey:"button.submit"}),busy:k,enabled:S,inline:!1,alignment:"right"})})]})})}},26049:function(e,t,n){n.d(t,{Z:function(){return a}});var i=n(57437),o=n(48024),r=n(43298),s=n(2265);function a(e){var t;let[n,a]=(0,s.useState)(null!==(t=e.sliderDefault)&&void 0!==t?t:0),[l,c]=(0,s.useState)("solo"===e.sliderMode?1:.5),d=(0,s.useMemo)(()=>(0,o.ZP)(r.ZP)({color:"secondary",height:"".concat(.8*l,"em"),"& .MuiSlider-thumb":{height:"".concat(1.6*l,"em"),width:"".concat(1.6*l,"em"),backgroundColor:"secondary",boxShadow:"0px 4px 10px 0px rgba(0, 0, 0, 0.25) inset","&::before":{display:"none"}},"& .MuiSlider-rail":{borderRadius:"".concat(.4*l,"em"),boxShadow:"0px 4px 10px 0px rgba(0, 0, 0, 0.25) inset"},"& .MuiSlider-track":{borderRadius:"".concat(.4*l,"em"),boxShadow:"0px 4px 10px 0px rgba(0, 0, 0, 0.25) inset"},"& .MuiSlider-markLabel":{fontSize:"".concat(1*l,"rem"),marginTop:"".concat(2.5*l,"em")}}),[l]);return(0,i.jsx)(d,{...e,value:n,onChange:(e,t)=>{a(t)},onChangeCommitted:(t,n)=>{let i=n;e.acceptableRange&&i>e.acceptableRange.max&&(i=e.acceptableRange.max),e.acceptableRange&&i<e.acceptableRange.min&&(i=e.acceptableRange.min),a(i),e.onCommit(i)}})}},45231:function(e,t,n){n.d(t,{A:function(){return s}});var i=n(57437),o=n(43298),r=n(80511);let s=e=>{let t=e["data-index"],n=e.ownerState.marks[t],s=e.ownerState.marks.length,a={...e.style,width:"".concat(100/s,"%"),wordWrap:"normal",whiteSpace:"wrap"};return(0,i.jsx)(o.J$,{...e,style:a,children:(0,i.jsx)(r.Z,{variant:"sliderMark",style:{display:"block",wordWrap:"normal",whiteSpace:"wrap"},children:n.label})})}},45080:function(e,t,n){n.d(t,{L:function(){return o},Z:function(){return P}});var i,o,r=n(57437),s=n(8260),a=n(94547),l=n(7630),c=n(49428),d=n(22960),u=n(31193),h=n(66858),p=n(44908),x=n(11929),m=n(96537),f=n(69065),g=n(66124),y=n(60335),b=n(80511),v=n(19309),j=n(2265),w=n(48620),k=n(49752),Z=n(73391),S=n(60320);let C=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,D=(e,t,n)=>{let i=[],r=null!=t?t:"";switch(e){case o.text:let s=n?r.length>0?null:"Please enter an answer":null;null!==s&&i.push(s);break;case o.email:let a=C.test(r.trim()),l=n?r.trim().length>0&&a?null:"Please enter a valid email address.":0===r.trim().length||a?null:"Please enter a valid email address.";null!==l&&i.push(l);break;default:throw"Unsupported TextInputType"}return i},I=(e,t)=>{if(console.debug("Validating checkboxes",e),void 0===e)return["Checkbox data undefined."];let n=e.filter(e=>e.checked).length,i=e.map((e,t)=>e.required&&!e.checked?"The ".concat((0,Z.q)(t+1)," checkbox is required."):null).filter(e=>null!==e).map(e=>e),o=[];return n<t&&o.push("Please select at least ".concat(t," ").concat(1===t?"checkbox":"checkboxes",".")),[...i,...o]},E=()=>(0,r.jsx)(S.Z,{children:(0,r.jsx)("svg",{focusable:"false","aria-hidden":"true","data-testid":"CheckBoxBlankIcon",children:(0,r.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5",fill:"white"})})});(i=o||(o={}))[i.text=0]="text",i[i.email=1]="email";let A=(e,t)=>({...e,jsonValue:{answers:[{key:"text",stringValue:t.answer},...t.checks.map(e=>({key:e.key,stringValue:e.text,booleanValue:e.checked}))]}}),q=(e,t)=>{var n,i;return{answer:null===(i=e.jsonValue)||void 0===i?void 0:null===(n=i.answers.find(e=>"text"===e.key))||void 0===n?void 0:n.stringValue,checks:t.map(t=>{var n,i,o;return{key:t.key,text:t.text,initial:t.initial,checked:null!==(o=null===(i=e.jsonValue)||void 0===i?void 0:null===(n=i.answers.find(e=>e.key===t.key))||void 0===n?void 0:n.booleanValue)&&void 0!==o?o:t.initial,required:t.required}})}};function P(e){let{answers:t}=(0,s.ZP)(e.qids.qid),[n,i]=(0,j.useState)((0,s.Zp)(t,e.qids,e.question.pii)),[o,Z]=(0,j.useState)({answer:void 0,checks:[]}),[S,C]=(0,j.useState)(!1),[P,T]=(0,j.useState)(!0),[_,F]=(0,j.useState)(e.role===a._b.Client),[R,B]=(0,j.useState)(!1),[U,V]=(0,j.useState)(!1),[M,N]=(0,j.useState)([]),[O,W]=(0,j.useState)(),[K,L]=(0,j.useState)(!1),z=()=>{L(!1)};(0,j.useEffect)(()=>{Z(q(n,e.checkboxes))},[n,e.checkboxes]);let G=()=>{var t,n;let i=[...I(o.checks,e.minCheckboxes),...D(e.type,o.answer,e.textRequired)],r=(null!==(n=null===(t=o.answer)||void 0===t?void 0:t.length)&&void 0!==n?n:0)>0;return T(!U||0===i.length&&(r||!e.textRequired)),N(i),0===i.length};(0,j.useEffect)(()=>{U&&G()},[o]);let H=async()=>{if(e.role===a._b.Client&&P){if(V(!0),G()){let t=A(n,o);console.debug("Submitting TextInput",t),C(!0),e.onAnswer(t).then(t=>{if(console.debug("Answer submitted ".concat(t?"ok":"error")),console.debug("Received answer response",t),null!==t)Z(q(t,e.checkboxes));else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{C(!1)})}}else console.warn("Only participants can submit answers")},J=async()=>{let t=A(n,{...o,answer:void 0,checks:[]});C(!0),e.onAnswer(t).then(t=>{if(console.debug("Answer submitted ".concat(t?"ok":"error")),console.debug("Received answer response",t),null!==t)Z(q(t,e.checkboxes));else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{C(!1)})},Y=(e,t)=>{let n={...o,checks:[...o.checks]};n.checks.find(t=>t.key===e).checked=t,Z(n)};return(0,j.useEffect)(()=>{W(M.join(" ")),B(M.length>0)},[M]),(0,d.Z)(),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(u.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.question&&(0,r.jsx)(u.Z,{sx:{mb:4},children:(0,r.jsx)(w.Z,{content:e.question})}),(0,r.jsx)(h.Z,{label:e.label,variant:"outlined",defaultValue:o.answer,helperText:O,type:1===e.type?"email":"text",onChange:e=>{Z({...o,answer:e.target.value})},error:R,color:"buttonStandard",autoComplete:"off",InputProps:{sx:{background:"white",fontSize:"2rem"}},InputLabelProps:{sx:{fontSize:"2rem","&.MuiOutlinedInput-notchedOutline":{fontSize:"2rem"}}},sx:{mb:2}}),o.checks.map((t,n)=>(0,r.jsx)(u.Z,{display:"flex",flexDirection:"row",children:(0,r.jsx)(p.Z,{control:(0,r.jsx)(x.Z,{checked:t.checked,onChange:(e,n)=>Y(t.key,n),icon:e.forceCheckboxesWhite?(0,r.jsx)(E,{}):void 0}),label:t.text})},"checkbox-".concat(e.qids.qid,"-").concat(n,"-").concat(t.key))),e.information&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.Z,{variant:"text",fullWidth:!1,color:"buttonStandard",sx:{textDecoration:"underline",alignSelf:"start",mt:2},startIcon:(0,r.jsx)(c.Z,{}),onClick:()=>L(!0),children:e.information.heading}),(0,r.jsx)(f.Z,{fullWidth:!0,maxWidth:"md",open:K,onClose:z,children:(0,r.jsxs)(g.Z,{children:[(0,r.jsx)(u.Z,{style:{position:"absolute",top:0,right:0},children:(0,r.jsx)(y.Z,{"aria-label":"close",onClick:z,children:(0,r.jsx)(l.Z,{})})}),(0,r.jsx)(u.Z,{sx:{p:2},display:"flex",flexDirection:"column",children:e.information.body.map((t,n)=>(0,r.jsx)(b.Z,{variant:"slideInfoText",align:"left",dangerouslySetInnerHTML:{__html:(0,v.Z)(t)}},"".concat(e.qids.qid,"-info-body-").concat(n)))})]})})]}),(0,r.jsxs)(u.Z,{sx:{display:"flex",flexDirection:"row",gap:1,justifyContent:"end",alignItems:"end"},children:[e.skipText&&(0,r.jsx)(k.Z,{inline:!0,busy:S,onSubmit:J,large:!0,variant:"outlined",text:e.skipText,enabled:!0}),(0,r.jsx)(k.Z,{inline:!0,busy:S,onSubmit:H,large:!0,text:e.submitText,enabled:!U||P})]})]})})}},48620:function(e,t,n){n.d(t,{Z:function(){return s}});var i=n(57437),o=n(31193),r=n(80511);function s(e){var t,n,s,a,l,c;return(0,i.jsx)(i.Fragment,{children:((null===(t=e.content)||void 0===t?void 0:t.explanation)||(null===(n=e.content)||void 0===n?void 0:n.instruction)||(null===(s=e.content)||void 0===s?void 0:s.question))&&(0,i.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"column",gap:1,alignItems:"stretch"},children:[e.content.instruction&&(0,i.jsx)(r.Z,{variant:"questionInstruction",align:null!==(a=e.forceAlign)&&void 0!==a?a:"center",component:"div",sx:{alignSelf:"stretch",...e.sx},children:e.content.instruction}),e.content.question&&(0,i.jsx)(r.Z,{variant:"questionPrompt",align:null!==(l=e.forceAlign)&&void 0!==l?l:"center",component:"div",sx:{alignSelf:"stretch",...e.sx},children:e.content.question}),e.content.explanation&&(0,i.jsx)(r.Z,{variant:"questionExplanation",align:null!==(c=e.forceAlign)&&void 0!==c?c:"center",component:"div",sx:{alignSelf:"stretch",...e.sx},children:e.content.explanation})]})})}},2962:function(e,t,n){n.d(t,{J:function(){return o},Z:function(){return b}});var i,o,r=n(57437),s=n(8260),a=n(83593),l=n(22960),c=n(41506),d=n(28651),u=n(97294),h=n(43152),p=n(22599),x=n.n(p),m=n(2265),f=n(35231),g=n(48620),y=n(24132);function b(e){let{answers:t}=(0,s.ZP)(e.qids.qid),[n,i]=(0,m.useState)();(0,m.useEffect)(()=>{switch(e.inputType){case y.rT.categorical:i((0,y.dx)(t,e.categories,e.range));break;case y.rT.numerical:i((0,y.B8)((0,y.tJ)(t,e.range)));break;default:throw"Unsupported GraphInputType"}setTimeout(()=>{a.Z.emit({type:a.M.Request_SlideRefresh})},1e3)},[t,e.categories,e.inputType,e.range]);let o={scaleType:"linear",tickInterval:x().range(0,1e3,1),tickLabelInterval:e=>(0,p.isInteger)(e),valueFormatter:e=>"".concat(e.toFixed(0)),disableLine:!0,disableTicks:!1},b={scaleType:"band",dataKey:"category",disableLine:!1,disableTicks:!1},v=(0,l.Z)();return(0,r.jsxs)(r.Fragment,{children:[e.question&&(0,r.jsx)(g.Z,{content:e.question}),(0,r.jsx)(f.h,{width:"100%",height:"100%",minWidth:50,minHeight:50,children:(0,r.jsx)(c.v,{layout:1===e.orientation?"vertical":"horizontal",margin:{left:150},grid:{horizontal:1===e.orientation,vertical:0===e.orientation},dataset:n,barLabel:"value",sx:{[".".concat(d.Is.root)]:{},".MuiBarElement-series-votes_id":{fill:v.palette.secondary.main},".MuiBarLabel-series-votes_id":{fill:"white",fontWeight:"bolder"},["& .".concat(h.k.line)]:{strokeDasharray:"5 3",strokeWidth:1},[".".concat(u.x.tickContainer)]:{textWrap:"wrap"},[".".concat(u.x.tickLabel)]:{fontSize:"1rem !important"}},slotProps:{bar:{rx:4,ry:4}},xAxis:[1===e.orientation?b:o],yAxis:[1===e.orientation?o:b],series:[{dataKey:"votes",label:void 0,id:"votes_id",valueFormatter:e=>null===e?"No data":1===e?"1 vote":"".concat(e.toFixed(0)," votes")}]})})]})}(i=o||(o={}))[i.horizontal=0]="horizontal",i[i.vertical=1]="vertical"},24132:function(e,t,n){n.d(t,{B8:function(){return f},dx:function(){return u},rT:function(){return s},tJ:function(){return h}});var i,o,r,s,a=n(22599),l=n.n(a);(i=r||(r={}))[i.bar=0]="bar",(o=s||(s={}))[o.categorical=0]="categorical",o[o.numerical=1]="numerical";let c=e=>{var t,n;return l().range(e.lo,e.hi+(null!==(t=e.step)&&void 0!==t?t:1),null!==(n=e.step)&&void 0!==n?n:1)},d=e=>e.replace(/\\n/g,"\n"),u=(e,t,n)=>p(e,t,n).map((t,n)=>({category:d(t),votes:x(e,n)})),h=(e,t)=>c(t).map(t=>({value:t,votes:m(e,t)})),p=(e,t,n)=>{let i=void 0!==t?t:void 0!==n?c(n).map(e=>"".concat(e)):void 0;if(void 0===i)throw"Cannot determine categories";return i.filter(e=>void 0!==e).map(e=>e)},x=(e,t)=>l().sum(e.map(e=>{var n;return l().sum(null===(n=e.jsonValue)||void 0===n?void 0:n.answers.filter(e=>e.index===t).map(e=>{var t;return null!==(t=e.numericValue)&&void 0!==t?t:0}))})),m=(e,t)=>x(e,t),f=e=>e.map(e=>({category:"".concat(e.value),votes:e.votes}))},78364:function(e,t,n){n.d(t,{Z:function(){return d}});var i=n(57437),o=n(2265),r=n(77412),s=n(11144),a=n(4766),l=n(5085),c=n(94547);function d(){let e=(0,o.useContext)(l.rZ),{session:t}=(0,o.useContext)(s.z),{slideIndex:n}=(0,o.useContext)(a.X),[d]=(0,r.Z)("/sounds/00-ding.mp3",{volume:.5});return(0,o.useEffect)(()=>{(e.role===c._b.Controller||t.remoteConfiguration!==c.VS.InPerson)&&d()},[e.role,t.remoteConfiguration,n,d]),(0,i.jsx)(i.Fragment,{})}},73391:function(e,t,n){n.d(t,{q:function(){return i}});let i=e=>{let t=e%10,n=e%100;return 1===t&&11!==n?e+"st":2===t&&12!==n?e+"nd":3===t&&13!==n?e+"rd":e+"th"}}}]);